<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>linux_kernel</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="theme.css" />
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#linux-å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°">Linux å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°</a>
<ul>
<li><a href="#ç›®å½•">ç›®å½•</a>
<ul>
<li><a href="#ä¸€è¿œç¨‹ç™»å½•-ssh-æœåŠ¡å™¨æµç¨‹">ä¸€ã€è¿œç¨‹ç™»å½• SSH æœåŠ¡å™¨æµç¨‹</a></li>
<li><a href="#äºŒå†…æ ¸ç¼–è¯‘ç¯å¢ƒ">äºŒã€å†…æ ¸ç¼–è¯‘ç¯å¢ƒ</a></li>
<li><a href="#ä¸‰ä½¿ç”¨qemu">ä¸‰ã€ä½¿ç”¨QEMU</a></li>
<li><a href="#å››gdbè°ƒè¯•">å››ã€GDBè°ƒè¯•</a></li>
<li><a href="#äº”ä¸ªäººåšå®¢æ­å»º">äº”ã€ä¸ªäººåšå®¢æ­å»º</a></li>
<li><a href="#å…­å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥">å…­ã€å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</a></li>
<li><a href="#ä¸ƒæ–‡ä»¶ç³»ç»Ÿ">ä¸ƒã€æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#å…«nfsæ–‡ä»¶ç³»ç»Ÿ">å…«ã€nfsæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#ä¹bpf">ä¹ã€BPF</a></li>
<li><a href="#åsmbæ–‡ä»¶ç³»ç»Ÿ">åã€SMBæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#åä¸€linux-å†…æ ¸å®æˆ˜">åä¸€ã€Linux å†…æ ¸å®æˆ˜</a></li>
<li><a href="#åäºŒlinuxå†…æ ¸æºç è§£è¯»">åäºŒã€Linuxå†…æ ¸æºç è§£è¯»</a></li>
<li><a href="#é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°tips">é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°Tips</a></li>
</ul></li>
<li><a href="#å¾…åŠç†">å¾…åŠç†</a></li>
</ul></li>
</ul>
</nav>
<h1 id="linux-å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°">Linux å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°</h1>
<hr />
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><a href="#ä¸€è¿œç¨‹ç™»å½•-ssh-æœåŠ¡å™¨æµç¨‹">ä¸€ã€è¿œç¨‹ç™»å½• SSH æœåŠ¡å™¨</a></li>
<li><a href="#äºŒå†…æ ¸ç¼–è¯‘ç¯å¢ƒ">äºŒã€é…ç½®ç¼–è¯‘ç¯å¢ƒ</a></li>
<li><a href="#ä¸‰ä½¿ç”¨qemu">ä¸‰ã€ä½¿ç”¨ QEMU</a></li>
<li><a href="#å››gdbè°ƒè¯•">å››ã€GDB è°ƒè¯•</a></li>
<li><a href="#äº”ä¸ªäººåšå®¢æ­å»º">äº”ã€ä¸ªäººåšå®¢æ­å»º</a></li>
<li><a href="#å…­å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥">å…­ã€å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</a></li>
<li><a href="#ä¸ƒæ–‡ä»¶ç³»ç»Ÿ">ä¸ƒã€æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#å…«nfsæ–‡ä»¶ç³»ç»Ÿ">å…«ã€NFSæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#ä¹bpf">ä¹ã€BPF</a></li>
<li><a href="#åsmbæ–‡ä»¶ç³»ç»Ÿ">åã€SMBæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#åä¸€linux-å†…æ ¸å®æˆ˜">åä¸€ã€Linux å†…æ ¸å®æˆ˜</a></li>
<li><a href="#åäºŒlinuxå†…æ ¸æºç é˜…è¯»è®°å½•">åäºŒã€Linuxå†…æ ¸æºç é˜…è¯»è®°å½•</a></li>
</ul>
<hr />
<h3 id="ä¸€è¿œç¨‹ç™»å½•-ssh-æœåŠ¡å™¨æµç¨‹">ä¸€ã€è¿œç¨‹ç™»å½• SSH æœåŠ¡å™¨æµç¨‹</h3>
<p>Windows/Linux â†’ ç‰©ç†æœåŠ¡å™¨ â†’ Dockerå®¹å™¨ â†’ QEMUè™šæ‹Ÿæœº</p>
<pre><code>ssh è´¦å·@193.x.x.x
ssh è´¦å·@172.x.x.x
exit    #é€€å‡º</code></pre>
<h4 id="å®‰è£…-code-server">å®‰è£… code-server</h4>
<p><code>curl -fsSL https://code-server.dev/install.sh | sh</code></p>
<h4 id="ç”Ÿæˆä»£ç ç´¢å¼•">ç”Ÿæˆä»£ç ç´¢å¼•</h4>
<p><code>make gtags  # ç”¨äº VSCode çš„ä»£ç è·³è½¬åŠŸèƒ½</code></p>
<h3 id="äºŒå†…æ ¸ç¼–è¯‘ç¯å¢ƒ">äºŒã€å†…æ ¸ç¼–è¯‘ç¯å¢ƒ</h3>
<h4 id="å†…æ ¸ç¼–è¯‘æµç¨‹">1.å†…æ ¸ç¼–è¯‘æµç¨‹</h4>
<h5 id="åˆ›å»ºä¸“ç”¨ç¼–è¯‘ç›®å½•">åˆ›å»ºä¸“ç”¨ç¼–è¯‘ç›®å½•</h5>
<p><code>mkdir build</code></p>
<h5 id="é…ç½®å†…æ ¸é€‰é¡¹">é…ç½®å†…æ ¸é€‰é¡¹</h5>
<p><code>make O=build menuconfig</code></p>
<h5 id="ç¼–è¯‘å†…æ ¸é•œåƒ">ç¼–è¯‘å†…æ ¸é•œåƒ</h5>
<p><code>make O=build bzImage -j$(nproc)</code></p>
<h5 id="makeå†…å®¹è¡¥å……">makeå†…å®¹è¡¥å……</h5>
<p>å¯ä»¥ä½¿ç”¨<code>make help | less</code>æŸ¥çœ‹<code>make</code>å‘½ä»¤çš„å…·ä½“å†…å®¹</p>
<pre><code>#æ¸…ç†ç¯å¢ƒç›¸å…³
make mrproper           #æ¸…ç†ç¯å¢ƒ å½»åº•æ¸…ç†æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶ã€é…ç½®æ–‡ä»¶åŠå¤‡ä»½æ–‡ä»¶ï¼ˆéœ€é‡æ–°é…ç½®å†…æ ¸ï¼‰
make distclean          #åœ¨ mrproper åŸºç¡€ä¸Šï¼Œé¢å¤–åˆ é™¤ç¼–è¾‘å™¨å¤‡ä»½å’Œè¡¥ä¸æ–‡ä»¶ï¼ˆå®Œå…¨å¹²å‡€çš„ç¯å¢ƒï¼‰

#é…ç½®å†…æ ¸ç›¸å…³
make defconfig          # ç”Ÿæˆé»˜è®¤é…ç½®
make menuconfig         # è‡ªå®šä¹‰è°ƒæ•´é…ç½®
make xconfig / make gconfig #åˆ†åˆ«ä½¿ç”¨ Qt æˆ– GTK+ å›¾å½¢ç•Œé¢é…ç½®å†…æ ¸ï¼ˆé€‚åˆæ¡Œé¢ç¯å¢ƒï¼‰
make localmodconfig     #æ ¹æ®å½“å‰åŠ è½½çš„æ¨¡å—ç”Ÿæˆç²¾ç®€é…ç½®ï¼ˆç¦ç”¨æœªä½¿ç”¨çš„æ¨¡å—ï¼‰
make allyesconfig       #å°†æ‰€æœ‰é€‰é¡¹è®¾ç½®ä¸º yesï¼ˆç”Ÿæˆæœ€å¤§åŒ–çš„å†…æ ¸ï¼Œç”¨äºæµ‹è¯•
make allnoconfig        #å°†æ‰€æœ‰é€‰é¡¹è®¾ç½®ä¸º noï¼ˆæœ€å°åŒ–å†…æ ¸ï¼Œéœ€æ‰‹åŠ¨å¯ç”¨åŠŸèƒ½ï¼‰
make testconfig         #è¿è¡Œ Kconfig çš„å•å…ƒæµ‹è¯•
make debug.config       # å°† debug.config åˆå¹¶åˆ°å½“å‰ .config æ–‡ä»¶
make x86_debug.config       #é’ˆå¯¹ x86/x86_64 æ¶æ„çš„ è°ƒè¯•å’Œæµ‹è¯•é€‰é¡¹
make kvm_guest.config       #ä¼˜åŒ–å†…æ ¸é…ç½®ä»¥ä½œä¸º KVM è™šæ‹Ÿæœºå®¢æˆ·æœºï¼ˆGuest OSï¼‰ è¿è¡Œ

#ç¼–è¯‘å†…æ ¸ä¸æ¨¡å—
make vmlinux        #ç¼–è¯‘ç”Ÿæˆå†…æ ¸çš„è£¸äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæœªå‹ç¼©çš„å†…æ ¸é•œåƒï¼‰
make modules_install    #å°†ç¼–è¯‘å¥½çš„æ¨¡å—å®‰è£…åˆ° /lib/modules/$(uname -r)/ ç›®å½•
make headers_install    #å®‰è£…å†…æ ¸å¤´æ–‡ä»¶åˆ° ./usrï¼ˆç”¨äºå¼€å‘ç”¨æˆ·ç©ºé—´ç¨‹åºï¼‰</code></pre>
<h4 id="æ¨¡å—ç‹¬ç«‹ç¼–è¯‘">2.æ¨¡å—ç‹¬ç«‹ç¼–è¯‘</h4>
<h5 id="ä¿®æ”¹makefieæ–‡ä»¶">ä¿®æ”¹makefieæ–‡ä»¶</h5>
<p><code>CONFIG_EXT2_FS := m  # è®¾ç½®ä¸ºæ¨¡å—ç¼–è¯‘</code></p>
<h5 id="æ‰§è¡Œç¼–è¯‘">æ‰§è¡Œç¼–è¯‘</h5>
<p><code>make -C /path/to/kernel/source M=$(pwd) modules</code></p>
<h4 id="å†…æ ¸æ–‡æ¡£ç¼–è¯‘">3.å†…æ ¸æ–‡æ¡£ç¼–è¯‘</h4>
<p><code>make O=build SPHINXOPTS=-v htmldocs -j$(nproc)</code> #ç”Ÿæˆå†…æ ¸çš„HTMLç‰ˆæœ¬</p>
<h3 id="ä¸‰ä½¿ç”¨qemu">ä¸‰ã€ä½¿ç”¨QEMU</h3>
<p><strong>qemuå®‰è£…å‚è€ƒï¼š</strong><a href="https://www.qemu.org/download/#linux">qemuå®˜ç½‘</a></p>
<p><strong>qemuçš„start.shéœ€è¦å…³æ³¨çš„</strong>:</p>
<pre><code>-append &quot;nokaslr ...&quot;   é˜²æ­¢åœ°å€éšæœºåŒ–ï¼Œç¼–è¯‘å†…æ ¸æ—¶å…³é—­é…ç½® CONFIG_RANDOMIZE_BASE
-S    æŒ‚èµ· gdbserver
-gdb tcp:: 5555 #æŒ‡å®šç«¯å£å·5555
-s   ç›¸å½“äº-gdb tcp::1234</code></pre>
<p>åœ¨æ¯æ¬¡å¯åŠ¨qemuâ€™è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œå¯ä»¥å…ˆä½¿ç”¨<code>ps -e -o pid,ppid,args | grep qemu</code> å…ˆæŸ¥çœ‹æœ‰æ²¡æœ‰å¤šä¸ªè™šæ‹Ÿæœºå¼€å¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªè¿›ç¨‹éƒ½æ˜¯å¼€å¯çš„ qenu-system-x86_64 è¾“å‡ºçš„çˆ¶å­è¿›ç¨‹å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š <code>5601 â†’ 5602 (sudo) â†’ 5603 (sudo) â†’ 5604 (qenu-system-x86_64)</code></p>
<h4 id="æœåŠ¡å™¨ç«¯">æœåŠ¡å™¨ç«¯</h4>
<pre><code>tmux ls                     # æŸ¥çœ‹ä¼šè¯åˆ—è¡¨
tmux attach -t qemu         # è¿›å…¥ qemu ä¼šè¯
cd /home/dingpenglong/qemu-kernel/vm/1.Fedora-Server-dvd-x86_64-40-1.14
bash start.sh               # å¯åŠ¨ QEMU è™šæ‹Ÿæœº</code></pre>
<h4 id="è™šæ‹Ÿæœºç«¯">è™šæ‹Ÿæœºç«¯</h4>
<pre><code>cd /home/linux/qemu-kernel
cat /etc/*release*          # éªŒè¯ç³»ç»Ÿä¿¡æ¯
ps -e -o pid,ppid,args | grep qemu  # æ£€æŸ¥ QEMU è¿›ç¨‹</code></pre>
<h3 id="å››gdbè°ƒè¯•">å››ã€GDBè°ƒè¯•</h3>
<pre><code>#åŸºç¡€è°ƒè¯•
target remote:5555          #ä½ çš„è°ƒè¯•å™¨ï¼ˆGDBï¼‰è¿æ¥åˆ°é‚£å°&quot;è¿œç¨‹ç”µè„‘&quot;ï¼Œè®© GDB å¯ä»¥æ§åˆ¶å®ƒçš„æ‰§è¡Œ
target remote :1234             # è¿æ¥ QEMU è°ƒè¯•ç«¯å£
c                               # ç»§ç»­æ‰§è¡Œ (Continue)
Ctrl+C                           # ä¸­æ–­ç¨‹åºæ‰§è¡Œ
si                              # å•æ­¥æ‰§è¡Œæ±‡ç¼–æŒ‡ä»¤ (Step Instruction)
n                               # æºä»£ç çº§å•æ­¥è·³è¿‡ (Next)
s                               # æºä»£ç çº§å•æ­¥è¿›å…¥ (Step)

#æ–­ç‚¹è°ƒè¯•
b start_kernel              # åœ¨å‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹
b *0xffffffff81000000           # åœ¨æŒ‡å®šåœ°å€è®¾ç½®æ–­ç‚¹
watch *(int*)0x1234         # ç›‘æ§å†…å­˜åœ°å€å†™å…¥
rwatch [expression]         # ç›‘æ§å†…å­˜è¯»å–
info breakpoints            # æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹
disable 2               # ç¦ç”¨ 2 å·æ–­ç‚¹
delete 3                # åˆ é™¤ 3 å·æ–­ç‚¹

#ä¸Šä¸‹æ–‡æŸ¥çœ‹
bt                  # æŸ¥çœ‹è°ƒç”¨æ ˆ (BackTrace)
info registers              # æ˜¾ç¤ºæ‰€æœ‰å¯„å­˜å™¨å€¼
p $rax                  # æŸ¥çœ‹ RAX å¯„å­˜å™¨å€¼
p $lx_current().pid         #æ‰“å°æ–­ç‚¹çš„è¿›ç¨‹
p $lx_current().comm            #æ‰“å°æ–­ç‚¹çš„è¿›ç¨‹
&amp;((struct cifsFileInfo *)0)-&gt;tlink  #æ‰“å°ç»“æ„ä½“åç§»é‡

#å†…å­˜æ“ä½œ
x/10x 0x1234                # ä»¥åå…­è¿›åˆ¶æŸ¥çœ‹ 10 ä¸ªå†…å­˜å­—
x/20s 0xabcd                # æŸ¥çœ‹å†…å­˜ä¸­çš„ ASCII å­—ç¬¦ä¸²
x/i $pc                 # åæ±‡ç¼–å½“å‰æŒ‡ä»¤
disassemble /r              # å¸¦æœºå™¨ç åæ±‡ç¼–å½“å‰å‡½æ•°
set {int}0x1234 = 5         # ä¿®æ”¹å†…å­˜å€¼</code></pre>
<h3 id="äº”ä¸ªäººåšå®¢æ­å»º">äº”ã€ä¸ªäººåšå®¢æ­å»º</h3>
<h4 id="åŸŸåé…ç½®æµç¨‹">åŸŸåé…ç½®æµç¨‹</h4>
<ol type="1">
<li>é˜¿é‡Œäº‘æ³¨å†Œ<code>yourname.com</code></li>
<li>æ·»åŠ  DNS è§£æè®°å½•</li>
</ol>
<pre><code>GitHub Pages çš„ IP åœ°å€ï¼š 185.199.108.153 185.199.109.153 185.199.110.153 185.199.111.153</code></pre>
<ol start="3" type="1">
<li>GitHubPages é…ç½®</li>
</ol>
<pre><code>åˆ›å»º &lt;username&gt;.github.io ä»“åº“
å¯ç”¨ GitHub Pages æœåŠ¡
é…ç½®è‡ªå®šä¹‰åŸŸå</code></pre>
<ol start="4" type="1">
<li>ä½¿ç”¨<code>pandoc</code>å°†markdownæ–‡ä»¶ç”Ÿæˆç±»ä¼¼Linuxæºç æ ¼å¼çš„htmlæ–‡ä»¶</li>
</ol>
<pre><code># ä¸‹è½½Linuxå†…æ ¸å®˜æ–¹CSS
wget https://kernel.org/doc/html/latest/_static/css/theme.css
pandoc input.md -o output.html --css=theme.css --toc --standalone</code></pre>
<h3 id="å…­å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥">å…­ã€å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h3>
<p><a href="https://linuxcommand.p2hp.com/">Linuxå‘½ä»¤å¤§å…¨</a></p>
<h4 id="vimç¼–è¾‘å™¨">1.vimç¼–è¾‘å™¨</h4>
<p><a href="https://www.runoob.com/linux/linux-vim.html">Vimç¼–è¾‘å™¨èœé¸Ÿæ•™ç¨‹</a> <a href="https://yianwillis.github.io/vimcdoc/doc/quickref.html">Vimå®˜æ–¹æ‰‹å†Œä¸­æ–‡ç‰ˆ</a></p>
<pre><code>:w      #ä¿å­˜æ–‡ä»¶
:wqæˆ–zz      #ä¿å­˜å¹¶é€€å‡º
x       #åˆ é™¤å…‰æ ‡æ‰€åœ¨å­—ç¬¦ 
dd          #åˆ é™¤å½“å‰è¡Œ
gg      #å®šä½åˆ°é¦–è¡Œ
u       #æ’¤å›æ“ä½œ
:5,10d      #åˆ é™¤5åˆ°10è¡Œ
vè¿›å…¥å¯è§†æ¨¡å¼ï¼Œé€‰æ‹©å¤šè¡ŒåæŒ‰d 
Ctrl + Z    #æŒ‚èµ· Vim åˆ°åå°
fg      #ä»åå°æ¢å¤ Vim
/keyword    #å‘ä¸‹æœç´¢ keyword
?keyword    #å‘ä¸Šæœç´¢ keyword
:%s/old/new/g   #å…¨å±€æ›¿æ¢æ‰€æœ‰ old ä¸º new
:%s/old/new/gc  #æ›¿æ¢æ—¶é€ä¸ªç¡®è®¤</code></pre>
<p>vimè¿˜æœ‰ä¸€ä¸ªé«˜çº§çš„ç”¨æ³•å°±æ˜¯ç”¨vimé˜…è¯»å†…æ ¸æºç ï¼Œé¦–å…ˆéœ€è¦åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œ<code>ctags -R</code> è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆç´¢å¼•æ–‡ä»¶ï¼Œ<code>ls -l tags</code>æŸ¥çœ‹ç´¢å¼•æ–‡ä»¶</p>
<pre class="â€˜"><code>vimä¸­ï¼š
1.ctrl + ] #è·³è½¬åˆ°å‡½æ•°æˆ–è€…å˜é‡çš„å®šä¹‰
2. ctrl + o #è¿”å›åˆ°åŸæ¥çš„ä½ç½®
3. g ctrl +] #è·³è½¬åˆ°å‡½æ•°æˆ–è€…å˜é‡çš„å®šä¹‰ï¼Œè¿™ä¸ªæ¯”ç¬¬ä¸€ä¸ªå¤šä¸€ä¸ªé€‰æ‹©ã€‚</code></pre>
<h4 id="gitç‰ˆæœ¬æ§åˆ¶">2.Gitç‰ˆæœ¬æ§åˆ¶</h4>
<p><a href="https://www.runoob.com/git/git-tutorial.html">Gitèœé¸Ÿæ•™ç¨‹</a></p>
<pre><code>git init            #åœ¨å½“å‰ç›®å½•åˆå§‹åŒ– Git ä»“åº“
git log         #æŸ¥çœ‹æäº¤å†å² --onelineï¼ˆç®€æ´æ˜¾ç¤ºï¼‰ã€-pï¼ˆæ˜¾ç¤ºå·®å¼‚ï¼‰
git status      #æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€ï¼ˆä¿®æ”¹/æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼‰
git add &lt;file&gt;      #å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº  git add .ï¼ˆæ·»åŠ æ‰€æœ‰æ–‡ä»¶ï¼‰
git pull        #æ‹‰å–è¿œç¨‹ä»“åº“å¹¶åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ git pull origin main
git fetch       #ä»…æ‹‰å–è¿œç¨‹ä»“åº“æ›´æ–°ï¼Œä¸è‡ªåŠ¨åˆå¹¶    git fetch --all
git reset       #å›é€€æäº¤   --softï¼ˆä¿ç•™ä¿®æ”¹ï¼‰ã€--hardï¼ˆä¸¢å¼ƒä¿®æ”¹ï¼‰
git diff        #æŸ¥çœ‹å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„å·®å¼‚   git diff HEADï¼ˆæ¯”è¾ƒæœ€æ–°æäº¤ï¼‰
git commit      #æäº¤æš‚å­˜åŒºçš„ä¿®æ”¹   -m &quot;message&quot;ï¼ˆæ·»åŠ æäº¤ä¿¡æ¯ï¼‰
git revert &lt;commit&gt; #æ’¤é”€æŒ‡å®šæäº¤ï¼ˆç”Ÿæˆæ–°æäº¤ï¼‰  git revert HEADï¼ˆæ’¤é”€æœ€æ–°æäº¤ï¼‰
git rm &lt;file&gt;  åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹çš„æ–‡ä»¶
git rm --cached  &lt;file&gt; åˆ é™¤è¿œç¨‹çš„æ–‡ä»¶ï¼Œä¿ç•™æœ¬åœ°</code></pre>
<p><strong>GITä½¿ç”¨æµç¨‹</strong>:</p>
<pre><code>git init(å¦‚æœè¦ä¸Šä¼ æœ¬åœ°ä»“åº“)
git clone https:...   #å…‹éš†gitä¸Šçš„ä»£ç 
git checkout -b new-feature  #ä¸ºäº†é¿å…ç›´æ¥åœ¨ main æˆ– master åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯
git add &lt;file&gt;         #æ·»åŠ åˆ°æš‚å­˜åŒº
git commit -m &quot;&quot;       #æäº¤æ›´æ”¹
git pull origin master #æ‹‰å–è¿œç«¯æ›´æ–°å¹¶ä¸”åˆå¹¶åˆ°æœ¬åœ°ï¼Œæœ€å¥½ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°çš„æ›´æ”¹ï¼Œä»¥é¿å…å†²çª
git push origin master #æ¨é€åˆ°è¿œç¨‹ä»“åº“</code></pre>
<p><strong>æ¨èä¸€ä¸ªç™»é™†gitç½‘ç«™çš„å¥½ç”¨çš„å·¥å…·</strong> <a href="https://steampp.net/">Steam++</a></p>
<p>å¬è¿™ä¸ªåå­—å°±çŸ¥é“ï¼Œä¹‹å‰ä¸€ç›´ç”¨è¿™ä¸ªè½¯ä»¶å»ç™»é™†steamå•†åº—ï¼Œå¶ç„¶å‘ç°è¿˜èƒ½åŠ é€ŸGitHubï¼Œå…è´¹ä¸”æµç•…</p>
<h4 id="tmuxç»ˆç«¯å¤ç”¨">3.Tmuxç»ˆç«¯å¤ç”¨</h4>
<pre><code>tmux new -s &lt;name&gt;  #åˆ›å»ºåä¸º &lt;name&gt; çš„æ–°ä¼šè¯
Ctrl + B D      #é€€å‡ºå½“å‰ä¼šè¯
tmux det
tmux ls         #æ˜¾ç¤ºæ‰€æœ‰ä¼šè¯tm
tmux attach -t &lt;name&gt;   #é‡æ–°è¿æ¥åˆ°æŒ‡å®šä¼šè¯
Ctrl + B C      #æ–°å»ºçª—å£
Ctrl + B N/P        #åˆ‡æ¢ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªçª—å£
Ctrl + B %      #å‚ç›´åˆ†å‰²çª—æ ¼
Ctrl + B &quot;      #æ°´å¹³åˆ†å‰²çª—æ ¼</code></pre>
<h4 id="psè¿›ç¨‹ç®¡ç†">4.psè¿›ç¨‹ç®¡ç†</h4>
<pre><code>ps aux          #æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯    
ps -eo pid,ppid,cmd #æ˜¾ç¤ºè¿›ç¨‹çš„ PIDã€PPID å’Œå®Œæ•´å‘½ä»¤   
ps -ef | grep &lt;è¿›ç¨‹å&gt; #è¿‡æ»¤ç‰¹å®šè¿›ç¨‹ ps -ef | grep nginx
ps -e -o pid,ppid,args | grep qemu    #ç”¨äºæŸ¥è¯¢qemuè™šæ‹Ÿæœºçš„pidã€ppidã€args æ¯æ¬¡å¯åŠ¨qemuè™šæ‹Ÿæœºçš„æ—¶å€™è¦ç¡®ä¿æ²¡æœ‰åŒæ—¶å¼€å¯å¤šä¸ªè™šæ‹Ÿæœº</code></pre>
<h4 id="sshscpè¿œç¨‹è¿æ¥">5.SSH&amp;SCPè¿œç¨‹è¿æ¥</h4>
<pre><code>ssh user@host               #ä¾‹å¦‚ssh root@192.168.1.100
ssh -p &lt;port&gt; user@host         #æŒ‡å®šç«¯å£ç™»å½•
scp file user@host:/path        #ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœº
scp user@host:/path/file local_dir  #ä»è¿œç¨‹ä¸»æœºä¸‹è½½æ–‡ä»¶
ssh-copy-id user@host           #å°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº</code></pre>
<h3 id="ä¸ƒæ–‡ä»¶ç³»ç»Ÿ">ä¸ƒã€æ–‡ä»¶ç³»ç»Ÿ</h3>
<h4 id="æ“ä½œæµç¨‹">1.æ“ä½œæµç¨‹</h4>
<pre><code>fallocate -l 1G 1
mkfs.ext4 -F /dev/sda           # æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ
mount -t ext4 /dev/sda /mnt     # æŠŠç£ç›˜æŒ‚è½½åˆ°æŸä¸ªç›®å½•
df /dev/sda # æŸ¥çœ‹æ˜¯å¦å·²ç»æŒ‚è½½ä¸Š
echo &quot;æˆ‘çˆ±æ“ä½œç³»ç»Ÿ&quot; &gt; /mnt/file   # å­˜åˆ°æŒ‚è½½ç‚¹ä¸‹çš„æŸä¸ªæ–‡ä»¶ä¸­
cat /mnt/file                   # è¾“å‡ºæ–‡ä»¶å†…å®¹
debugfs /dev/sda
# debugfs:  stats # Block size: 1024
# debugfs:  stat file # BLOCKS: (0):7169
dd if=/dev/sda of=./data bs=1 skip=7341056 count=20  #å…·ä½“çš„skip=å¤šå°‘éœ€è¦æ ¹æ®Block size å’ŒBLOCKSè®¡ç®—
cat data
umount /mnt                     # å¸è½½æ–‡ä»¶ç³»ç»Ÿ</code></pre>
<h4 id="åŸºæœ¬æ¦‚å¿µ">2.åŸºæœ¬æ¦‚å¿µ</h4>
<ul>
<li><ol type="1">
<li>è¶…çº§å—æ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æè¿°ï¼›</li>
</ol></li>
<li><ol start="2" type="1">
<li>ç´¢å¼•èŠ‚ç‚¹inodeæ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶ç‰©ç†å±æ€§çš„æè¿°ï¼›</li>
</ol></li>
<li><ol start="3" type="1">
<li>ç›®å½•é¡¹dentryæ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶é€»è¾‘å±æ€§çš„æè¿°ï¼›</li>
</ol></li>
<li><ol start="4" type="1">
<li>æ–‡ä»¶fileæ˜¯å¯¹å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶çš„æè¿°ï¼›</li>
</ol></li>
</ul>
<p>ä¸€ä¸ªè¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯æ˜¯ç”±fs_structæ¥æè¿°çš„ï¼ˆå¦‚å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–‡ä»¶å’Œå½“å‰å·¥ä½œç›®å½•ï¼‰ï¼Œä¸€ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶é›†æ˜¯ç”±files_structæ¥æè¿°çš„ï¼Œè€Œæ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶æ˜¯ç”±fileç»“æ„æè¿°çš„ã€‚</p>
<h4 id="æ–‡ä»¶æ•°æ®ç»“æ„çš„ç†è§£å’Œé‡ç‚¹">3.æ–‡ä»¶æ•°æ®ç»“æ„çš„ç†è§£å’Œé‡ç‚¹ï¼š</h4>
<ul>
<li><ol type="1">
<li>å¤šä¸ªç›®å½•ä¸‹denrtyå¯¹åº”åŒä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹inode</li>
</ol></li>
<li><ol start="2" type="1">
<li>æ–‡ä»¶å¤¹ä¸‹çš„nlinkä»£è¡¨çš„æ˜¯æ–‡ä»¶å¤¹çš„å­ç›®å½•æ•°ï¼ˆä¸åŒ…å«æ–‡ä»¶ï¼‰</li>
</ol></li>
<li><ol start="3" type="1">
<li>æ–‡ä»¶çš„nlinkä»£è¡¨çš„æ˜¯ç¡¬é“¾æ¥æ•°</li>
</ol></li>
</ul>
<h3 id="å…«nfsæ–‡ä»¶ç³»ç»Ÿ">å…«ã€nfsæ–‡ä»¶ç³»ç»Ÿ</h3>
<h4 id="nfsç¯å¢ƒ">1.nfsç¯å¢ƒ</h4>
<h5 id="server-ç¯å¢ƒ">1.1 Server ç¯å¢ƒ</h5>
<p>nfs serverè½¯ä»¶å®‰è£…</p>
<pre><code>apt-get install nfs-kernel-server -y # debian
dnf install nfs-utils -y # openeuler</code></pre>
<p>ç„¶åéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/exports</p>
<pre><code>/tmp/ *(rw,no_root_squash,fsid=0)           #å…±äº«tmpç›®å½• *ä»£è¡¨å…è®¸æ‰€æœ‰IPåœ°è´¨è®¿é—®å…±äº«ç›®å½•ï¼Œrw å…è®¸è¯»å†™ï¼Œno_root_squash å…è®¸å®¢æˆ·ç«¯rootç”¨æˆ·ç›´æ¥ä»¥æœåŠ¡ç«¯rootæƒé™æ“ä½œæ–‡ä»¶ï¼ŒNFSv4 è¦æ±‚ä¸€ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆfsid=0ï¼‰ï¼Œå…¶ä»–å¯¼å‡ºåº”ä½œä¸ºå…¶å­ç›®å½•ã€‚
/tmp/s_test/ *(rw,no_root_squash,fsid=1)
/tmp/s_scratch *(rw,no_root_squash,fsid=2)</code></pre>
<h5 id="client-ç¯å¢ƒ">1.2 Client ç¯å¢ƒ</h5>
<p>nfs clientè½¯ä»¶å®‰è£…</p>
<pre><code>apt-get install nfs-common -y # debian
dnf install nfs-utils -y # openeuler</code></pre>
<p>nfs clinet æŒ‚è½½å‘½ä»¤ï¼š</p>
<pre><code>mount -t nfs -o vers=4.0 ${server_ip}:/s_test /mnt
mount -t nfs -o vers=4.1 ${server_ip}:/s_test /mnt
mount -t nfs -o vers=4.2 ${server_ip}:/s_test /mnt   #è¿™é‡Œçš„server_ipå¡«å†™å®é™…çš„NFSæœåŠ¡å™¨åœ°å€</code></pre>
<p>ä¸€èˆ¬éƒ½ä¼šæŒ‡å®šversçš„ç‰ˆæœ¬ï¼Œå¦‚æœserverç«¯æ²¡æœ‰é…ç½®fisdï¼Œé‚£ä¹ˆæŒ‚è½½çš„æ ¹è·¯å¾„å°†æ˜¯/ï¼Œéœ€è¦ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š <code>mount -t nfs -o vers=4.0 ${server_ip}:/tmp/s_test /mnt # æˆ– tmp/s_test</code></p>
<h3 id="ä¹bpf">ä¹ã€BPF</h3>
<ul>
<li><ol type="1">
<li>BPFå…¨ç§°æ˜¯ã€ŒBerkeley Packet Filterã€,ç¿»è¯‘è¿‡æ¥æ˜¯ã€Œä¼¯å…‹åˆ©åŒ…è¿‡æ»¤å™¨ã€ã€‚</li>
</ol></li>
<li><ol start="2" type="1">
<li>é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦BPFå‘¢ï¼Ÿè¿™å°±å¾—æåˆ°å¾ˆå¤šå¹´å‰çš„ç¨‹åºéƒ½æ˜¯ä½œä¸ºç”¨æˆ·çº§è¿›ç¨‹è¿›è¡Œçš„ï¼Œä¸ºäº†åˆ†æåªåœ¨å†…æ ¸ç©ºé—´çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®éƒ½å¾—ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„å†…å­˜ä¸­ï¼Œå› æ­¤ä¼šæœ‰å¤§é‡çš„å¼€é”€ã€‚</li>
</ol></li>
<li><ol start="3" type="1">
<li>éšç€ç°åœ¨çš„æ•°æ®å¢å¤šï¼Œä¸å¾—ä¸æ”¾å¼ƒåœ¨ç”¨æˆ·ç©ºé—´åˆ†æå†…æ ¸æ•°æ®ï¼Œå› è€ŒBPFåº”è¿è€Œç”Ÿâ€”â€”ä¸€ç§åœ¨å†…æ ¸ç©ºé—´æ‰§è¡Œé«˜æ•ˆå®‰å…¨çš„ç¨‹åºçš„æœºåˆ¶ã€‚è¿™é‡ŒBPFçš„åŸç†å°±ä¸æ·±ç©¶äº†ï¼Œå…·ä½“çœ‹æ€ä¹ˆä½¿ç”¨ã€‚</li>
</ol></li>
</ul>
<pre><code>å…ˆå®‰è£…bpftraceï¼š
    apt-get install bpftrace  #ubuntuç³»ç»Ÿ
    dnf install bpftrace   ##fedroaç³»ç»Ÿ
æˆ‘é€šè¿‡ubuntuçš„aptå®‰è£…çš„æ˜¯0.14å‘è¡Œç‰ˆï¼Œä½†bpftraceä¼šå‡ºç°&quot;æ®µé”™è¯¯&quot;ã€‚æˆ‘æºç å®‰è£…éƒ½æ²¡ç”¨ï¼Œå¤ªğŸ€è›‹äº†ï¼ï¼ï¼
ç½‘ä¸ŠæŸ¥é˜…åˆ°çš„è§£æå°±æ˜¯ï¼Œä½ å†å®‰è£…ä¸€éæ–°ç‰ˆæœ¬ï¼Œv-0.14ç‰ˆæœ¬å¤ªè€äº†ã€‚ä¸‹è½½APPImageå®‰è£…å§ã€‚</code></pre>
<p><a href="https://github.com/bpftrace/bpftrace/discussions/3026">bpf -0.14 æ®µé”™è¯¯å®˜æ–¹å›ç­”</a></p>
<pre><code>ç¼–å†™test.bt:
kprobe:ext2_read_folio
{
        @start[tid] = nsecs;
        printf(&quot;kprobe\n&quot;);
        print(kstack());
}

kretprobe:ext2_read_folio
{
        $us = (nsecs - @start[tid]) / 100;
        printf(&quot;kretprobe, duration %d\n&quot;, $us);
        delete(@start[tid]);
        print(kstack());
}
ç„¶åæ‰§è¡Œå‘½ä»¤
bpftrace test.bt &amp;
mkfs.ext2 -F image
mount image /mnt
echo something &gt; /mnt/file
echo 3 &gt; /proc/sys/vm/drop_caches
cat /mnt/file</code></pre>
<p>test.bt è„šæœ¬é€šè¿‡ä»¥ä¸‹æ–¹å¼è·Ÿè¸ª ext2_read_folio è„šæœ¬ä¸­åŒ…å«ä¸¤ä¸ªæ¢é’ˆï¼ˆkprobe å’Œ kretprobeï¼‰ï¼Œè®°å½•è¿›å…¥readå‡½æ•°å’Œå‡ºreadå‡½æ•°çš„æ—¶é—´æˆ³ï¼Œå¹¶è®¡ç®—ã€‚</p>
<h4 id="åœ¨ubuntu-22.04ä¸Šå®‰è£…bccçš„å®Œæ•´æŒ‡å—">åœ¨Ubuntu 22.04ä¸Šå®‰è£…BCCçš„å®Œæ•´æŒ‡å—</h4>
<h5 id="bcc-bpf-compiler-collection-æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºé«˜æ•ˆå†…æ ¸è¿½è¸ªå’Œæ“ä½œå·¥å…·çš„å·¥å…·åŒ…åŸºäºæ‰©å±•çš„ä¼¯å…‹åˆ©åŒ…è¿‡æ»¤å™¨ebpfæŠ€æœ¯æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨ubuntu-22.04ä¸Šå®‰è£…å’ŒéªŒè¯bccçš„æ­¥éª¤">BCC (BPF Compiler Collection) æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºé«˜æ•ˆå†…æ ¸è¿½è¸ªå’Œæ“ä½œå·¥å…·çš„å·¥å…·åŒ…ï¼ŒåŸºäºæ‰©å±•çš„ä¼¯å…‹åˆ©åŒ…è¿‡æ»¤å™¨(eBPF)æŠ€æœ¯ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨Ubuntu 22.04ä¸Šå®‰è£…å’ŒéªŒè¯BCCçš„æ­¥éª¤ã€‚</h5>
<h5 id="æ–¹æ³•ä¸€ä½¿ç”¨ppaæºå®‰è£…æ¨è">æ–¹æ³•ä¸€ï¼šä½¿ç”¨PPAæºå®‰è£…ï¼ˆæ¨èï¼‰</h5>
<p>è¿™æ˜¯æœ€ç®€å•å¿«æ·çš„å®‰è£…æ–¹æ³•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç”¨æˆ·ã€‚</p>
<h6 id="æ­¥éª¤1æ·»åŠ bcc-ppaæº">æ­¥éª¤1ï¼šæ·»åŠ BCC PPAæº</h6>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="fu">sudo</span> apt-add-repository ppa:hadret/bpfcc</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="fu">sudo</span> apt-get update</span></code></pre></div>
<h6 id="æ­¥éª¤2å®‰è£…bccåŒ…">æ­¥éª¤2ï¼šå®‰è£…BCCåŒ…</h6>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y bpfcc-tools python3-bpfcc</span></code></pre></div>
<h6 id="æ­¥éª¤3éªŒè¯å®‰è£…">æ­¥éª¤3ï¼šéªŒè¯å®‰è£…</h6>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="co"># åˆ—å‡ºå·²å®‰è£…çš„BCCå·¥å…·</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="fu">find</span> /usr -name <span class="st">&quot;*-bpfcc&quot;</span> -type f <span class="kw">|</span> <span class="fu">sort</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a><span class="co"># éªŒè¯Pythonæ¨¡å—</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a><span class="ex">python3</span> -c <span class="st">&quot;import bcc; print(bcc.__file__)&quot;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a><span class="co"># æµ‹è¯•è¿è¡ŒBCCç¨‹åºï¼ˆä¾‹å¦‚execsnoopï¼‰</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a><span class="fu">sudo</span> execsnoop-bpfcc -h</span></code></pre></div>
<h5 id="æ–¹æ³•äºŒä»æºä»£ç ç¼–è¯‘å®‰è£…">æ–¹æ³•äºŒï¼šä»æºä»£ç ç¼–è¯‘å®‰è£…</h5>
<p>å¦‚æœä½ éœ€è¦æœ€æ–°ç‰ˆæœ¬æˆ–è‡ªå®šä¹‰æ„å»ºï¼Œå¯ä»¥ä»æºä»£ç å®‰è£…ã€‚</p>
<h6 id="æ­¥éª¤1å®‰è£…ä¾èµ–é¡¹">æ­¥éª¤1ï¼šå®‰è£…ä¾èµ–é¡¹</h6>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="co"># å®‰è£…åŸºæœ¬ä¾èµ–</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="fu">sudo</span> apt-get update</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y bison build-essential cmake flex git libedit-dev <span class="kw">\</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>  <span class="ex">libllvm14</span> llvm-14-dev libclang-14-dev python3 zlib1g-dev libelf-dev <span class="kw">\</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a>  <span class="ex">libfl-dev</span> python3-pip</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a><span class="co"># å®‰è£…å…¶ä»–ä¾èµ–</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y arping clang-14 dh-python libdbus-1-dev libluajit-5.1-dev <span class="kw">\</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true"></a>  <span class="ex">luajit</span> libpcap-dev libpython3-dev libzip-dev python3-netaddr python3-pyroute2</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true"></a><span class="co"># å®‰è£…å†…æ ¸å¤´æ–‡ä»¶</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y linux-headers-<span class="va">$(</span><span class="fu">uname</span> -r<span class="va">)</span></span></code></pre></div>
<h6 id="æ­¥éª¤2å…‹éš†bccä»“åº“">æ­¥éª¤2ï¼šå…‹éš†BCCä»“åº“</h6>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="bu">cd</span> ~</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="fu">git</span> clone https://github.com/iovisor/bcc.git</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a><span class="co"># å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒï¼š</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a><span class="co"># git clone https://gitee.com/mirrors/bcc.git</span></span></code></pre></div>
<h6 id="æ­¥éª¤3ç¼–è¯‘å’Œå®‰è£…">æ­¥éª¤3ï¼šç¼–è¯‘å’Œå®‰è£…</h6>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="fu">mkdir</span> -p ~/bcc/build <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ~/bcc/build</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="fu">cmake</span> -DCMAKE_INSTALL_PREFIX=/usr -DPYTHON_CMD=python3 ..</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="fu">make</span> -j<span class="va">$(</span><span class="ex">nproc</span><span class="va">)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a><span class="fu">sudo</span> make install</span></code></pre></div>
<h6 id="æ­¥éª¤4éªŒè¯å®‰è£…">æ­¥éª¤4ï¼šéªŒè¯å®‰è£…</h6>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="co"># éªŒè¯Pythonæ¨¡å—</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a><span class="ex">python3</span> -c <span class="st">&quot;import bcc; print(bcc.__file__)&quot;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a><span class="co"># æµ‹è¯•BCCå·¥å…·</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a><span class="fu">sudo</span> /usr/share/bcc/tools/execsnoop</span></code></pre></div>
<h5 id="åˆ›å»ºå¹¶è¿è¡Œè‡ªå·±çš„bccç¨‹åº">åˆ›å»ºå¹¶è¿è¡Œè‡ªå·±çš„BCCç¨‹åº</h5>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="co">#!/usr/bin/python3</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="co"># æ–‡ä»¶å: test_bcc.py</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a><span class="im">from</span> bcc <span class="im">import</span> BPF</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a><span class="co"># å®šä¹‰BPFç¨‹åº</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a>program <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a><span class="st">int hello(void *ctx) {</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a><span class="st">    bpf_trace_printk(&quot;Hello, BCC!</span><span class="ch">\\</span><span class="st">n&quot;);</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a><span class="st">    return 0;</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true"></a><span class="co"># åŠ è½½BPFç¨‹åº</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true"></a>b <span class="op">=</span> BPF(text<span class="op">=</span>program)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true"></a>b.attach_kprobe(event<span class="op">=</span>b.get_syscall_fnname(<span class="st">&quot;clone&quot;</span>), fn_name<span class="op">=</span><span class="st">&quot;hello&quot;</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true"></a><span class="co"># æ‰“å°å¤´éƒ¨</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;æ­£åœ¨è·Ÿè¸ªclone()ç³»ç»Ÿè°ƒç”¨...&quot;</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;æŒ‰Ctrl+Cé€€å‡º&quot;</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true"></a><span class="co"># è¯»å–å¹¶æ‰“å°traceè¾“å‡º</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true"></a><span class="cf">try</span>:</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true"></a>    b.trace_print()</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true"></a>    <span class="cf">pass</span></span></code></pre></div>
<p>è¿è¡Œæ­¤è„šæœ¬ï¼š</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a><span class="fu">chmod</span> +x test_bcc.py</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a><span class="fu">sudo</span> ./test_bcc.py</span></code></pre></div>
<h5 id="å¸¸ç”¨bccå·¥å…·">å¸¸ç”¨BCCå·¥å…·</h5>
<p>BCCå®‰è£…åæä¾›äº†è®¸å¤šå¼ºå¤§çš„å·¥å…·ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>execsnoop-bpfcc</code> - è·Ÿè¸ªæ–°è¿›ç¨‹çš„æ‰§è¡Œ</li>
<li><code>opensnoop-bpfcc</code> - è·Ÿè¸ªopen()ç³»ç»Ÿè°ƒç”¨</li>
<li><code>tcptracer-bpfcc</code> - è·Ÿè¸ªTCPè¿æ¥</li>
<li><code>tcpconnect-bpfcc</code> - è·Ÿè¸ªä¸»åŠ¨TCPè¿æ¥</li>
<li><code>tcpaccept-bpfcc</code> - è·Ÿè¸ªè¢«åŠ¨TCPè¿æ¥</li>
<li><code>biosnoop-bpfcc</code> - è·Ÿè¸ªå—I/Oå»¶è¿Ÿ</li>
<li><code>funccount-bpfcc</code> - ç»Ÿè®¡å‡½æ•°è°ƒç”¨æ¬¡æ•°</li>
<li><code>stackcount-bpfcc</code> - ç»Ÿè®¡å†…æ ¸å †æ ˆè½¨è¿¹</li>
</ul>
<p>ä½¿ç”¨è¿™äº›å·¥å…·æ—¶éœ€è¦åŠ ä¸Š<code>sudo</code>æƒé™ã€‚</p>
<h5 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h5>
<ul>
<li><a href="https://github.com/iovisor/bcc">BCCå®˜æ–¹GitHubä»“åº“</a></li>
<li><a href="https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md">BCCå‚è€ƒæŒ‡å—</a></li>
<li><a href="https://www.brendangregg.com/ebpf.html">Linux eBPFè¿½è¸ªå·¥å…·</a></li>
</ul>
<h3 id="åsmbæ–‡ä»¶ç³»ç»Ÿ">åã€SMBæ–‡ä»¶ç³»ç»Ÿ</h3>
<h4 id="serveræ­å»º">1.Serveræ­å»º</h4>
<h5 id="ç”¨æˆ·æ€">1.1 ç”¨æˆ·æ€</h5>
<pre><code># å¾…åŠç†</code></pre>
<h3 id="åä¸€linux-å†…æ ¸å®æˆ˜">åä¸€ã€Linux å†…æ ¸å®æˆ˜</h3>
<h4 id="nfsé—®é¢˜åˆ†æ"><a href="https://dingpenglong.com/linux_kernel_nfs_problem">nfsé—®é¢˜åˆ†æ</a></h4>
<h3 id="åäºŒlinuxå†…æ ¸æºç è§£è¯»">åäºŒã€Linuxå†…æ ¸æºç è§£è¯»</h3>
<h4 id="linuxå†…æ ¸æºç è§£è¯»"><a href="https://dingpenglong.com/linux_kernel_codestudy">Linuxå†…æ ¸æºç è§£è¯»</a></h4>
<h3 id="é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°tips">é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°Tips</h3>
<h4 id="è™šæ‹Ÿæœºå¡åœ¨äº†boot-form-hard-diské˜¶æ®µ">1. è™šæ‹Ÿæœºå¡åœ¨äº†Boot form Hard Diské˜¶æ®µ</h4>
<p>è¿™ç§æƒ…å†µåªèƒ½é‡è£…è™šæ‹Ÿæœºç³»ç»Ÿ<br />
æ³¨ï¼šåšå®éªŒåƒä¸‡ä¸è¦åœ¨Vitrual managerçš„è™šæ‹Ÿæœºä¸Šè·‘ï¼Œæœ€å¥½åœ¨qemuä¸Šè·‘ã€‚</p>
<h4 id="è°ƒè¯•è¡¥ä¸">2. è°ƒè¯•è¡¥ä¸</h4>
<ul>
<li>åº”ç”¨è¡¥ä¸ï¼š ç¡®ä¿ä½ çš„å·¥ä½œç›®å½•æ˜¯ä½ çš„Linuxå†…æ ¸æºä»£ç æ ¹ç›®å½•ï¼Œpatchå‘½ä»¤åº”ç”¨è¡¥ä¸<br />
<code>patch -p1 &lt; /home/linux/blog/course/kernel/src/0001-debug-vfs.patch</code></li>
<li>ç„¶åé…ç½®å†…æ ¸<code>make menuconfig</code>ã€ç¼–è¯‘å†…æ ¸<code>make bzImage -j8</code></li>
</ul>
<h4 id="git-cloneæ—¶å€™failed-to-connect-to-github.com-port-443-after-0-ms-è¿æ¥è¢«æ‹’ç»">3. git cloneæ—¶å€™ï¼šFailed to connect to github.com port 443 after 0 ms: è¿æ¥è¢«æ‹’ç»</h4>
<ul>
<li>å¦‚æœåœ¨å­¦æ ¡å’Œå…¬å¸æ— æ³•åœ¨ç½‘ç«™ä¸Šè®¿é—®ï¼Œå¯ä»¥ç”³è¯·ä¸€ä¸ªæœåŠ¡å™¨ä»£ç†ã€‚</li>
<li>æ£€æŸ¥é˜²ç«å¢™é…ç½®ã€‚<code>sudo systemctl disable firewalld</code></li>
</ul>
<h4 id="git-cloneæ—¶å€™failed-to-connect-to-github.com-port-443-after-0-ms-è¿æ¥è¢«æ‹’ç»-1">3.git cloneæ—¶å€™ï¼šFailed to connect to github.com port 443 after 0 ms: è¿æ¥è¢«æ‹’ç»</h4>
<ul>
<li><ol type="1">
<li>å¦‚æœåœ¨å­¦æ ¡å’Œå…¬å¸æ— æ³•åœ¨ç½‘ç«™ä¸Šè®¿é—®ï¼Œå¯ä»¥ç”³è¯·ä¸€ä¸ªæœåŠ¡å™¨ä»£ç†ã€‚</li>
</ol></li>
<li><ol start="2" type="1">
<li>æ£€æŸ¥é˜²ç«å¢™é…ç½®ã€‚<code>sudo systemctl disable firewalld</code></li>
</ol></li>
</ul>
<h4 id="ç¼–è¯‘çš„.koæ–‡ä»¶å¦‚ä½•æ˜ å°„åˆ°å†…æ ¸æ–‡ä»¶é‡Œé¢">4.ç¼–è¯‘çš„.koæ–‡ä»¶ï¼Œå¦‚ä½•æ˜ å°„åˆ°å†…æ ¸æ–‡ä»¶é‡Œé¢ï¼Ÿ</h4>
<ul>
<li><ol type="1">
<li>åŠ è½½å†…æ ¸æ¨¡å—:<code>sudo insmod your_module.ko</code> æˆ–è€…<code>sudo modprobe your_module</code></li>
</ol></li>
<li><ol start="2" type="1">
<li>éªŒè¯æ˜¯å¦åŠ è½½æˆåŠŸï¼š<code>lsmod | grep your_module</code></li>
</ol></li>
<li><ol start="3" type="1">
<li>å¸è½½æ¨¡å—ï¼š<code>sudo rmmod your_module</code></li>
</ol></li>
</ul>
<h4 id="é‡åˆ°æ— æ³•å¸è½½æŒ‚è½½æ–‡ä»¶">5.é‡åˆ°æ— æ³•å¸è½½æŒ‚è½½æ–‡ä»¶ï¼Ÿ</h4>
<ul>
<li><p>æœ‰æ—¶å€™umountæŒ‚è½½æ–‡ä»¶ä¼šå‡ºç°â€™device is busyâ€™çš„é—®é¢˜</p></li>
<li><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ä½¿ç”¨æŒ‚è½½ç‚¹çš„è¿›ç¨‹: <code>lsof +D &lt;æŒ‚è½½ç‚¹&gt;</code> <code>fuser -m &lt;æŒ‚è½½ç‚¹&gt;</code> æ‰¾åˆ°è¿›ç¨‹å·åï¼Œå°±å¯ä»¥ä½¿ç”¨<code>kill -SIGKILL &lt;è¿›ç¨‹å·&gt;</code> æ€æ­»è¿›ç¨‹</p></li>
</ul>
<h4 id="mount-ä½¿ç”¨nfs3.0ç‰ˆæœ¬æ— æ³•æŒ‚è½½çš„é—®é¢˜">6.mount ä½¿ç”¨nfs3.0ç‰ˆæœ¬æ— æ³•æŒ‚è½½çš„é—®é¢˜ï¼Ÿ</h4>
<ul>
<li>éœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ <code>mount -t nfs -o vers=3 ${server_ip}:/tmp/s_test /mnt</code></li>
</ul>
<h2 id="å¾…åŠç†">å¾…åŠç†</h2>
<p>pandoc PersonStudyRecord.md -o linux-style.html -s â€“toc â€“css=linux-style.css</p>
</body>
</html>
