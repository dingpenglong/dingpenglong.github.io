<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Linuxå†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="linux-style.css" />
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#linux-å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°">Linux å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°</a>
<ul>
<li><a href="#ç›®å½•">ç›®å½•</a>
<ul>
<li><a href="#ä¸€è¿œç¨‹ç™»å½•-ssh-æœåŠ¡å™¨æµç¨‹">ä¸€ã€è¿œç¨‹ç™»å½• SSH æœåŠ¡å™¨æµç¨‹</a></li>
<li><a href="#äºŒå†…æ ¸ç¼–è¯‘ç¯å¢ƒ">äºŒã€å†…æ ¸ç¼–è¯‘ç¯å¢ƒ</a></li>
<li><a href="#ä¸‰ä½¿ç”¨qemu">ä¸‰ã€ä½¿ç”¨QEMU</a></li>
<li><a href="#å››gdbè°ƒè¯•">å››ã€GDBè°ƒè¯•</a></li>
<li><a href="#äº”ä¸ªäººåšå®¢æ­å»º">äº”ã€ä¸ªäººåšå®¢æ­å»º</a></li>
<li><a href="#å…­å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥">å…­ã€å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</a></li>
<li><a href="#ä¸ƒæ–‡ä»¶ç³»ç»Ÿ">ä¸ƒã€æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#å…«nfsæ–‡ä»¶ç³»ç»Ÿ">å…«ã€nfsæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#ä¹bpf">ä¹ã€BPF</a></li>
<li><a href="#åsmbæ–‡ä»¶ç³»ç»Ÿ">åã€SMBæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#åä¸€linux-å†…æ ¸å®æˆ˜">åä¸€ã€Linux å†…æ ¸å®æˆ˜</a></li>
<li><a href="#é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°tips">é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°Tips</a></li>
</ul></li>
<li><a href="#å¾…åŠç†">å¾…åŠç†</a></li>
</ul></li>
</ul>
</nav>
<h1 id="linux-å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°">Linux å†…æ ¸å¼€å‘å­¦ä¹ ç¬”è®°</h1>
<hr />
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><a href="#ä¸€è¿œç¨‹ç™»å½•-ssh-æœåŠ¡å™¨æµç¨‹">ä¸€ã€è¿œç¨‹ç™»å½• SSH æœåŠ¡å™¨</a></li>
<li><a href="#äºŒå†…æ ¸ç¼–è¯‘ç¯å¢ƒ">äºŒã€é…ç½®ç¼–è¯‘ç¯å¢ƒ</a></li>
<li><a href="#ä¸‰ä½¿ç”¨qemu">ä¸‰ã€ä½¿ç”¨ QEMU</a></li>
<li><a href="#å››gdbè°ƒè¯•">å››ã€GDB è°ƒè¯•</a></li>
<li><a href="#äº”ä¸ªäººåšå®¢æ­å»º">äº”ã€ä¸ªäººåšå®¢æ­å»º</a></li>
<li><a href="#å…­å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥">å…­ã€å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</a></li>
<li><a href="#ä¸ƒæ–‡ä»¶ç³»ç»Ÿ">ä¸ƒã€æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#å…«nfsæ–‡ä»¶ç³»ç»Ÿ">å…«ã€NFSæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#ä¹bpf">ä¹ã€BPF</a></li>
<li><a href="#åsmbæ–‡ä»¶ç³»ç»Ÿ">åã€SMBæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#åä¸€linux-å†…æ ¸å®æˆ˜">åä¸€ã€Linux å†…æ ¸å®æˆ˜</a></li>
<li><a href="#åäºŒlinuxå†…æ ¸æºç é˜…è¯»è®°å½•">åäºŒã€Linuxå†…æ ¸æºç é˜…è¯»è®°å½•</a></li>
</ul>
<hr />
<h3 id="ä¸€è¿œç¨‹ç™»å½•-ssh-æœåŠ¡å™¨æµç¨‹">ä¸€ã€è¿œç¨‹ç™»å½• SSH æœåŠ¡å™¨æµç¨‹</h3>
<p>Windows/Linux â†’ ç‰©ç†æœåŠ¡å™¨ â†’ Dockerå®¹å™¨ â†’ QEMUè™šæ‹Ÿæœº</p>
<pre><code>ssh è´¦å·@193.x.x.x
ssh è´¦å·@172.x.x.x
exit    #é€€å‡º</code></pre>
<h4 id="å®‰è£…-code-server">å®‰è£… code-server</h4>
<p><code>curl -fsSL https://code-server.dev/install.sh | sh</code></p>
<h4 id="ç”Ÿæˆä»£ç ç´¢å¼•">ç”Ÿæˆä»£ç ç´¢å¼•</h4>
<p><code>make gtags  # ç”¨äº VSCode çš„ä»£ç è·³è½¬åŠŸèƒ½</code></p>
<h3 id="äºŒå†…æ ¸ç¼–è¯‘ç¯å¢ƒ">äºŒã€å†…æ ¸ç¼–è¯‘ç¯å¢ƒ</h3>
<h4 id="å†…æ ¸ç¼–è¯‘æµç¨‹">1.å†…æ ¸ç¼–è¯‘æµç¨‹</h4>
<h5 id="åˆ›å»ºä¸“ç”¨ç¼–è¯‘ç›®å½•">åˆ›å»ºä¸“ç”¨ç¼–è¯‘ç›®å½•</h5>
<p><code>mkdir build</code></p>
<h5 id="é…ç½®å†…æ ¸é€‰é¡¹">é…ç½®å†…æ ¸é€‰é¡¹</h5>
<p><code>make O=build menuconfig</code></p>
<h5 id="ç¼–è¯‘å†…æ ¸é•œåƒ">ç¼–è¯‘å†…æ ¸é•œåƒ</h5>
<p><code>make O=build bzImage -j$(nproc)</code> ##### makeå†…å®¹è¡¥å…… å¯ä»¥ä½¿ç”¨<code>make help | less</code>æŸ¥çœ‹<code>make</code>å‘½ä»¤çš„å…·ä½“å†…å®¹</p>
<pre><code>#æ¸…ç†ç¯å¢ƒç›¸å…³
make mrproper           #æ¸…ç†ç¯å¢ƒ å½»åº•æ¸…ç†æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶ã€é…ç½®æ–‡ä»¶åŠå¤‡ä»½æ–‡ä»¶ï¼ˆéœ€é‡æ–°é…ç½®å†…æ ¸ï¼‰
make distclean          #åœ¨ mrproper åŸºç¡€ä¸Šï¼Œé¢å¤–åˆ é™¤ç¼–è¾‘å™¨å¤‡ä»½å’Œè¡¥ä¸æ–‡ä»¶ï¼ˆå®Œå…¨å¹²å‡€çš„ç¯å¢ƒï¼‰

#é…ç½®å†…æ ¸ç›¸å…³
make defconfig          # ç”Ÿæˆé»˜è®¤é…ç½®
make menuconfig         # è‡ªå®šä¹‰è°ƒæ•´é…ç½®
make xconfig / make gconfig #åˆ†åˆ«ä½¿ç”¨ Qt æˆ– GTK+ å›¾å½¢ç•Œé¢é…ç½®å†…æ ¸ï¼ˆé€‚åˆæ¡Œé¢ç¯å¢ƒï¼‰
make localmodconfig     #æ ¹æ®å½“å‰åŠ è½½çš„æ¨¡å—ç”Ÿæˆç²¾ç®€é…ç½®ï¼ˆç¦ç”¨æœªä½¿ç”¨çš„æ¨¡å—ï¼‰
make allyesconfig       #å°†æ‰€æœ‰é€‰é¡¹è®¾ç½®ä¸º yesï¼ˆç”Ÿæˆæœ€å¤§åŒ–çš„å†…æ ¸ï¼Œç”¨äºæµ‹è¯•
make allnoconfig        #å°†æ‰€æœ‰é€‰é¡¹è®¾ç½®ä¸º noï¼ˆæœ€å°åŒ–å†…æ ¸ï¼Œéœ€æ‰‹åŠ¨å¯ç”¨åŠŸèƒ½ï¼‰
make testconfig         #è¿è¡Œ Kconfig çš„å•å…ƒæµ‹è¯•
make debug.config       # å°† debug.config åˆå¹¶åˆ°å½“å‰ .config æ–‡ä»¶
make x86_debug.config       #é’ˆå¯¹ x86/x86_64 æ¶æ„çš„ è°ƒè¯•å’Œæµ‹è¯•é€‰é¡¹
make kvm_guest.config       #ä¼˜åŒ–å†…æ ¸é…ç½®ä»¥ä½œä¸º KVM è™šæ‹Ÿæœºå®¢æˆ·æœºï¼ˆGuest OSï¼‰ è¿è¡Œ

#ç¼–è¯‘å†…æ ¸ä¸æ¨¡å—
make vmlinux        #ç¼–è¯‘ç”Ÿæˆå†…æ ¸çš„è£¸äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæœªå‹ç¼©çš„å†…æ ¸é•œåƒï¼‰
make modules_install    #å°†ç¼–è¯‘å¥½çš„æ¨¡å—å®‰è£…åˆ° /lib/modules/$(uname -r)/ ç›®å½•
make headers_install    #å®‰è£…å†…æ ¸å¤´æ–‡ä»¶åˆ° ./usrï¼ˆç”¨äºå¼€å‘ç”¨æˆ·ç©ºé—´ç¨‹åºï¼‰</code></pre>
<h4 id="æ¨¡å—ç‹¬ç«‹ç¼–è¯‘">2.æ¨¡å—ç‹¬ç«‹ç¼–è¯‘</h4>
<h5 id="ä¿®æ”¹makefieæ–‡ä»¶">ä¿®æ”¹makefieæ–‡ä»¶</h5>
<p><code>CONFIG_EXT2_FS := m  # è®¾ç½®ä¸ºæ¨¡å—ç¼–è¯‘</code></p>
<h5 id="æ‰§è¡Œç¼–è¯‘">æ‰§è¡Œç¼–è¯‘</h5>
<p><code>make -C /path/to/kernel/source M=$(pwd) modules</code></p>
<h4 id="å†…æ ¸æ–‡æ¡£ç¼–è¯‘">3.å†…æ ¸æ–‡æ¡£ç¼–è¯‘</h4>
<p><code>make O=build SPHINXOPTS=-v htmldocs -j$(nproc)</code> #ç”Ÿæˆå†…æ ¸çš„HTMLç‰ˆæœ¬</p>
<h3 id="ä¸‰ä½¿ç”¨qemu">ä¸‰ã€ä½¿ç”¨QEMU</h3>
<p><strong>qemuå®‰è£…å‚è€ƒï¼š</strong><a href="https://www.qemu.org/download/#linux">qemuå®˜ç½‘</a></p>
<p><strong>qemuçš„start.shéœ€è¦å…³æ³¨çš„</strong>:</p>
<pre><code>-append &quot;nokaslr ...&quot;   é˜²æ­¢åœ°å€éšæœºåŒ–ï¼Œç¼–è¯‘å†…æ ¸æ—¶å…³é—­é…ç½® CONFIG_RANDOMIZE_BASE
-S    æŒ‚èµ· gdbserver
-gdb tcp:: 5555 #æŒ‡å®šç«¯å£å·5555
-s   ç›¸å½“äº-gdb tcp::1234</code></pre>
<p>åœ¨æ¯æ¬¡å¯åŠ¨qemuâ€™è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œå¯ä»¥å…ˆä½¿ç”¨<code>ps -e -o pid,ppid,args | grep qemu</code> å…ˆæŸ¥çœ‹æœ‰æ²¡æœ‰å¤šä¸ªè™šæ‹Ÿæœºå¼€å¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªè¿›ç¨‹éƒ½æ˜¯å¼€å¯çš„ qenu-system-x86_64 è¾“å‡ºçš„çˆ¶å­è¿›ç¨‹å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š <code>5601 â†’ 5602 (sudo) â†’ 5603 (sudo) â†’ 5604 (qenu-system-x86_64)</code></p>
<h4 id="æœåŠ¡å™¨ç«¯">æœåŠ¡å™¨ç«¯</h4>
<pre><code>tmux ls                     # æŸ¥çœ‹ä¼šè¯åˆ—è¡¨
tmux attach -t qemu         # è¿›å…¥ qemu ä¼šè¯
cd /home/dingpenglong/qemu-kernel/vm/1.Fedora-Server-dvd-x86_64-40-1.14
bash start.sh               # å¯åŠ¨ QEMU è™šæ‹Ÿæœº</code></pre>
<h4 id="è™šæ‹Ÿæœºç«¯">è™šæ‹Ÿæœºç«¯</h4>
<pre><code>cd /home/linux/qemu-kernel
cat /etc/*release*          # éªŒè¯ç³»ç»Ÿä¿¡æ¯
ps -e -o pid,ppid,args | grep qemu  # æ£€æŸ¥ QEMU è¿›ç¨‹</code></pre>
<h3 id="å››gdbè°ƒè¯•">å››ã€GDBè°ƒè¯•</h3>
<pre><code>#åŸºç¡€è°ƒè¯•
target remote:5555          #ä½ çš„è°ƒè¯•å™¨ï¼ˆGDBï¼‰è¿æ¥åˆ°é‚£å°&quot;è¿œç¨‹ç”µè„‘&quot;ï¼Œè®© GDB å¯ä»¥æ§åˆ¶å®ƒçš„æ‰§è¡Œ
target remote :1234             # è¿æ¥ QEMU è°ƒè¯•ç«¯å£
c                               # ç»§ç»­æ‰§è¡Œ (Continue)
Ctrl+C                           # ä¸­æ–­ç¨‹åºæ‰§è¡Œ
si                              # å•æ­¥æ‰§è¡Œæ±‡ç¼–æŒ‡ä»¤ (Step Instruction)
n                               # æºä»£ç çº§å•æ­¥è·³è¿‡ (Next)
s                               # æºä»£ç çº§å•æ­¥è¿›å…¥ (Step)

#æ–­ç‚¹è°ƒè¯•
b start_kernel              # åœ¨å‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹
b *0xffffffff81000000           # åœ¨æŒ‡å®šåœ°å€è®¾ç½®æ–­ç‚¹
watch *(int*)0x1234         # ç›‘æ§å†…å­˜åœ°å€å†™å…¥
rwatch [expression]         # ç›‘æ§å†…å­˜è¯»å–
info breakpoints            # æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹
disable 2               # ç¦ç”¨ 2 å·æ–­ç‚¹
delete 3                # åˆ é™¤ 3 å·æ–­ç‚¹

#ä¸Šä¸‹æ–‡æŸ¥çœ‹
bt                  # æŸ¥çœ‹è°ƒç”¨æ ˆ (BackTrace)
info registers              # æ˜¾ç¤ºæ‰€æœ‰å¯„å­˜å™¨å€¼
p $rax                  # æŸ¥çœ‹ RAX å¯„å­˜å™¨å€¼
p $lx_current().pid         #æ‰“å°æ–­ç‚¹çš„è¿›ç¨‹
p $lx_current().comm            #æ‰“å°æ–­ç‚¹çš„è¿›ç¨‹
&amp;((struct cifsFileInfo *)0)-&gt;tlink  #æ‰“å°ç»“æ„ä½“åç§»é‡

#å†…å­˜æ“ä½œ
x/10x 0x1234                # ä»¥åå…­è¿›åˆ¶æŸ¥çœ‹ 10 ä¸ªå†…å­˜å­—
x/20s 0xabcd                # æŸ¥çœ‹å†…å­˜ä¸­çš„ ASCII å­—ç¬¦ä¸²
x/i $pc                 # åæ±‡ç¼–å½“å‰æŒ‡ä»¤
disassemble /r              # å¸¦æœºå™¨ç åæ±‡ç¼–å½“å‰å‡½æ•°
set {int}0x1234 = 5         # ä¿®æ”¹å†…å­˜å€¼</code></pre>
<h3 id="äº”ä¸ªäººåšå®¢æ­å»º">äº”ã€ä¸ªäººåšå®¢æ­å»º</h3>
<h4 id="åŸŸåé…ç½®æµç¨‹">åŸŸåé…ç½®æµç¨‹</h4>
<ol type="1">
<li>é˜¿é‡Œäº‘æ³¨å†Œ<code>yourname.com</code></li>
<li>æ·»åŠ  DNS è§£æè®°å½•</li>
</ol>
<pre><code>GitHub Pages çš„ IP åœ°å€ï¼š 185.199.108.153 185.199.109.153 185.199.110.153 185.199.111.153</code></pre>
<ol start="3" type="1">
<li>GitHubPages é…ç½®</li>
</ol>
<pre><code>åˆ›å»º &lt;username&gt;.github.io ä»“åº“
å¯ç”¨ GitHub Pages æœåŠ¡
é…ç½®è‡ªå®šä¹‰åŸŸå</code></pre>
<h3 id="å…­å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥">å…­ã€å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h3>
<p><a href="https://linuxcommand.p2hp.com/">Linuxå‘½ä»¤å¤§å…¨</a> </p>
<h4>1.vimç¼–è¾‘å™¨</h4>
<p>
  <a href="https://www.runoob.com/linux/linux-vim.html">Vimç¼–è¾‘å™¨èœé¸Ÿæ•™ç¨‹</a><br>
  <a href="https://yianwillis.github.io/vimcdoc/doc/quickref.html">Vimå®˜æ–¹æ‰‹å†Œä¸­æ–‡ç‰ˆ</a>
</p>
<pre><code>:w      #ä¿å­˜æ–‡ä»¶
:wqæˆ–zz      #ä¿å­˜å¹¶é€€å‡º
x       #åˆ é™¤å…‰æ ‡æ‰€åœ¨å­—ç¬¦ 
dd          #åˆ é™¤å½“å‰è¡Œ
gg      #å®šä½åˆ°é¦–è¡Œ
u       #æ’¤å›æ“ä½œ
:5,10d      #åˆ é™¤5åˆ°10è¡Œ
vè¿›å…¥å¯è§†æ¨¡å¼ï¼Œé€‰æ‹©å¤šè¡ŒåæŒ‰d 
Ctrl + Z    #æŒ‚èµ· Vim åˆ°åå°
fg      #ä»åå°æ¢å¤ Vim
/keyword    #å‘ä¸‹æœç´¢ keyword
?keyword    #å‘ä¸Šæœç´¢ keyword
:%s/old/new/g   #å…¨å±€æ›¿æ¢æ‰€æœ‰ old ä¸º new
:%s/old/new/gc  #æ›¿æ¢æ—¶é€ä¸ªç¡®è®¤</code></pre>
<h4 id="gitç‰ˆæœ¬æ§åˆ¶">2.Gitç‰ˆæœ¬æ§åˆ¶</h4>
<p><a href="https://www.runoob.com/git/git-tutorial.html">Gitèœé¸Ÿæ•™ç¨‹</a></p>
<pre><code>git init            #åœ¨å½“å‰ç›®å½•åˆå§‹åŒ– Git ä»“åº“
git log         #æŸ¥çœ‹æäº¤å†å² --onelineï¼ˆç®€æ´æ˜¾ç¤ºï¼‰ã€-pï¼ˆæ˜¾ç¤ºå·®å¼‚ï¼‰
git status      #æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€ï¼ˆä¿®æ”¹/æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼‰
git add &lt;file&gt;      #å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº  git add .ï¼ˆæ·»åŠ æ‰€æœ‰æ–‡ä»¶ï¼‰
git pull        #æ‹‰å–è¿œç¨‹ä»“åº“å¹¶åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ git pull origin main
git fetch       #ä»…æ‹‰å–è¿œç¨‹ä»“åº“æ›´æ–°ï¼Œä¸è‡ªåŠ¨åˆå¹¶    git fetch --all
git reset       #å›é€€æäº¤   --softï¼ˆä¿ç•™ä¿®æ”¹ï¼‰ã€--hardï¼ˆä¸¢å¼ƒä¿®æ”¹ï¼‰
git diff        #æŸ¥çœ‹å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„å·®å¼‚   git diff HEADï¼ˆæ¯”è¾ƒæœ€æ–°æäº¤ï¼‰
git commit      #æäº¤æš‚å­˜åŒºçš„ä¿®æ”¹   -m &quot;message&quot;ï¼ˆæ·»åŠ æäº¤ä¿¡æ¯ï¼‰
git revert &lt;commit&gt; #æ’¤é”€æŒ‡å®šæäº¤ï¼ˆç”Ÿæˆæ–°æäº¤ï¼‰  git revert HEADï¼ˆæ’¤é”€æœ€æ–°æäº¤ï¼‰</code></pre>
<p><strong>GITä½¿ç”¨æµç¨‹</strong>:</p>
<pre><code>git init(å¦‚æœè¦ä¸Šä¼ æœ¬åœ°ä»“åº“)
git clone https:...   #å…‹éš†gitä¸Šçš„ä»£ç 
git checkout -b new-feature  #ä¸ºäº†é¿å…ç›´æ¥åœ¨ main æˆ– master åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯
git add &lt;file&gt;         #æ·»åŠ åˆ°æš‚å­˜åŒº
git commit -m &quot;&quot;       #æäº¤æ›´æ”¹
git pull origin master #æ‹‰å–è¿œç«¯æ›´æ–°å¹¶ä¸”åˆå¹¶åˆ°æœ¬åœ°ï¼Œæœ€å¥½ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°çš„æ›´æ”¹ï¼Œä»¥é¿å…å†²çª
git push origin master #æ¨é€åˆ°è¿œç¨‹ä»“åº“</code></pre>
<p><strong>æ¨èä¸€ä¸ªç™»é™†gitç½‘ç«™çš„å¥½ç”¨çš„å·¥å…·</strong> <a href="https://steampp.net/">Steam++</a></p>
<p>å¬è¿™ä¸ªåå­—å°±çŸ¥é“ï¼Œä¹‹å‰ä¸€ç›´ç”¨è¿™ä¸ªè½¯ä»¶å»ç™»é™†steamå•†åº—ï¼Œå¶ç„¶å‘ç°è¿˜èƒ½åŠ é€ŸGitHubï¼Œå…è´¹ä¸”æµç•…</p>
<h4 id="tmuxç»ˆç«¯å¤ç”¨">3.Tmuxç»ˆç«¯å¤ç”¨</h4>
<pre><code>tmux new -s &lt;name&gt;  #åˆ›å»ºåä¸º &lt;name&gt; çš„æ–°ä¼šè¯
Ctrl + B D      #é€€å‡ºå½“å‰ä¼šè¯ï¼ˆä¼šè¯åœ¨åå°è¿è¡Œï¼‰
tmux ls         #æ˜¾ç¤ºæ‰€æœ‰ä¼šè¯
tmux attach -t &lt;name&gt;   #é‡æ–°è¿æ¥åˆ°æŒ‡å®šä¼šè¯
Ctrl + B C      #æ–°å»ºçª—å£
Ctrl + B N/P        #åˆ‡æ¢ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªçª—å£
Ctrl + B %      #å‚ç›´åˆ†å‰²çª—æ ¼
Ctrl + B &quot;      #æ°´å¹³åˆ†å‰²çª—æ ¼</code></pre>
<h4 id="psè¿›ç¨‹ç®¡ç†">4.psè¿›ç¨‹ç®¡ç†</h4>
<pre><code>ps aux          #æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯    
ps -eo pid,ppid,cmd #æ˜¾ç¤ºè¿›ç¨‹çš„ PIDã€PPID å’Œå®Œæ•´å‘½ä»¤   
ps -ef | grep &lt;è¿›ç¨‹å&gt; #è¿‡æ»¤ç‰¹å®šè¿›ç¨‹ ps -ef | grep nginx
ps -e -o pid,ppid,args | grep qemu    #ç”¨äºæŸ¥è¯¢qemuè™šæ‹Ÿæœºçš„pidã€ppidã€args æ¯æ¬¡å¯åŠ¨qemuè™šæ‹Ÿæœºçš„æ—¶å€™è¦ç¡®ä¿æ²¡æœ‰åŒæ—¶å¼€å¯å¤šä¸ªè™šæ‹Ÿæœº</code></pre>
<h4 id="sshscpè¿œç¨‹è¿æ¥">5.SSH&amp;SCPè¿œç¨‹è¿æ¥</h4>
<pre><code>ssh user@host               #ä¾‹å¦‚ssh root@192.168.1.100
ssh -p &lt;port&gt; user@host         #æŒ‡å®šç«¯å£ç™»å½•
scp file user@host:/path        #ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœº
scp user@host:/path/file local_dir  #ä»è¿œç¨‹ä¸»æœºä¸‹è½½æ–‡ä»¶
ssh-copy-id user@host           #å°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº</code></pre>
<h3 id="ä¸ƒæ–‡ä»¶ç³»ç»Ÿ">ä¸ƒã€æ–‡ä»¶ç³»ç»Ÿ</h3>
<h4 id="æ“ä½œæµç¨‹">1.æ“ä½œæµç¨‹</h4>
<pre><code>fallocate -l 1G 1
mkfs.ext4 -F /dev/sda           # æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ
mount -t ext4 /dev/sda /mnt     # æŠŠç£ç›˜æŒ‚è½½åˆ°æŸä¸ªç›®å½•
df /dev/sda # æŸ¥çœ‹æ˜¯å¦å·²ç»æŒ‚è½½ä¸Š
echo &quot;æˆ‘çˆ±æ“ä½œç³»ç»Ÿ&quot; &gt; /mnt/file   # å­˜åˆ°æŒ‚è½½ç‚¹ä¸‹çš„æŸä¸ªæ–‡ä»¶ä¸­
cat /mnt/file                   # è¾“å‡ºæ–‡ä»¶å†…å®¹
debugfs /dev/sda
# debugfs:  stats # Block size: 1024
# debugfs:  stat file # BLOCKS: (0):7169
dd if=/dev/sda of=./data bs=1 skip=7341056 count=20  #å…·ä½“çš„skip=å¤šå°‘éœ€è¦æ ¹æ®Block size å’ŒBLOCKSè®¡ç®—
cat data
umount /mnt                     # å¸è½½æ–‡ä»¶ç³»ç»Ÿ</code></pre>
<h4 id="åŸºæœ¬æ¦‚å¿µ">2.åŸºæœ¬æ¦‚å¿µ</h4>
<ul>
<li><ol type="1">
<li>è¶…çº§å—æ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æè¿°ï¼›</li>
</ol></li>
<li><ol start="2" type="1">
<li>ç´¢å¼•èŠ‚ç‚¹inodeæ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶ç‰©ç†å±æ€§çš„æè¿°ï¼›</li>
</ol></li>
<li><ol start="3" type="1">
<li>ç›®å½•é¡¹dentryæ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶é€»è¾‘å±æ€§çš„æè¿°ï¼›</li>
</ol></li>
<li><ol start="4" type="1">
<li>æ–‡ä»¶fileæ˜¯å¯¹å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶çš„æè¿°ï¼›</li>
</ol></li>
</ul>
<p>ä¸€ä¸ªè¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯æ˜¯ç”±fs_structæ¥æè¿°çš„ï¼ˆå¦‚å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–‡ä»¶å’Œå½“å‰å·¥ä½œç›®å½•ï¼‰ï¼Œä¸€ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶é›†æ˜¯ç”±files_structæ¥æè¿°çš„ï¼Œè€Œæ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶æ˜¯ç”±fileç»“æ„æè¿°çš„ã€‚</p>
<h4 id="æ–‡ä»¶æ•°æ®ç»“æ„çš„ç†è§£å’Œé‡ç‚¹">3.æ–‡ä»¶æ•°æ®ç»“æ„çš„ç†è§£å’Œé‡ç‚¹ï¼š</h4>
<ul>
<li><ol type="1">
<li>å¤šä¸ªç›®å½•ä¸‹denrtyå¯¹åº”åŒä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹inode</li>
</ol></li>
<li><ol start="2" type="1">
<li>æ–‡ä»¶å¤¹ä¸‹çš„nlinkä»£è¡¨çš„æ˜¯æ–‡ä»¶å¤¹çš„å­ç›®å½•æ•°ï¼ˆä¸åŒ…å«æ–‡ä»¶ï¼‰</li>
</ol></li>
<li><ol start="3" type="1">
<li>æ–‡ä»¶çš„nlinkä»£è¡¨çš„æ˜¯ç¡¬é“¾æ¥æ•°</li>
</ol></li>
</ul>
<h3 id="å…«nfsæ–‡ä»¶ç³»ç»Ÿ">å…«ã€nfsæ–‡ä»¶ç³»ç»Ÿ</h3>
<h4 id="nfsç¯å¢ƒ">1.nfsç¯å¢ƒ</h4>
<h5 id="server-ç¯å¢ƒ">1.1 Server ç¯å¢ƒ</h5>
<p>nfs serverè½¯ä»¶å®‰è£…</p>
<pre><code>apt-get install nfs-kernel-server -y # debian
dnf install nfs-utils -y # openeuler</code></pre>
<p>ç„¶åéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/exports</p>
<pre><code>/tmp/ *(rw,no_root_squash,fsid=0)           #å…±äº«tmpç›®å½• *ä»£è¡¨å…è®¸æ‰€æœ‰IPåœ°è´¨è®¿é—®å…±äº«ç›®å½•ï¼Œrw å…è®¸è¯»å†™ï¼Œno_root_squash å…è®¸å®¢æˆ·ç«¯rootç”¨æˆ·ç›´æ¥ä»¥æœåŠ¡ç«¯rootæƒé™æ“ä½œæ–‡ä»¶ï¼ŒNFSv4 è¦æ±‚ä¸€ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆfsid=0ï¼‰ï¼Œå…¶ä»–å¯¼å‡ºåº”ä½œä¸ºå…¶å­ç›®å½•ã€‚
/tmp/s_test/ *(rw,no_root_squash,fsid=1)
/tmp/s_scratch *(rw,no_root_squash,fsid=2)</code></pre>
<h5 id="client-ç¯å¢ƒ">1.2 Client ç¯å¢ƒ</h5>
<p>nfs clientè½¯ä»¶å®‰è£…</p>
<pre><code>apt-get install nfs-common -y # debian
dnf install nfs-utils -y # openeuler</code></pre>
<p>nfs clinet æŒ‚è½½å‘½ä»¤ï¼š</p>
<pre><code>mount -t nfs -o vers=4.0 ${server_ip}:/s_test /mnt
mount -t nfs -o vers=4.1 ${server_ip}:/s_test /mnt
mount -t nfs -o vers=4.2 ${server_ip}:/s_test /mnt   #è¿™é‡Œçš„server_ipå¡«å†™å®é™…çš„NFSæœåŠ¡å™¨åœ°å€</code></pre>
<p>ä¸€èˆ¬éƒ½ä¼šæŒ‡å®šversçš„ç‰ˆæœ¬ï¼Œå¦‚æœserverç«¯æ²¡æœ‰é…ç½®fisdï¼Œé‚£ä¹ˆæŒ‚è½½çš„æ ¹è·¯å¾„å°†æ˜¯/ï¼Œéœ€è¦ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š <code>mount -t nfs -o vers=4.0 ${server_ip}:/tmp/s_test /mnt # æˆ– tmp/s_test</code></p>
<h3 id="ä¹bpf">ä¹ã€BPF</h3>
<ul>
<li><ol type="1">
<li>BPFå…¨ç§°æ˜¯ã€ŒBerkeley Packet Filterã€,ç¿»è¯‘è¿‡æ¥æ˜¯ã€Œä¼¯å…‹åˆ©åŒ…è¿‡æ»¤å™¨ã€ã€‚</li>
</ol></li>
<li><ol start="2" type="1">
<li>é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦BPFå‘¢ï¼Ÿè¿™å°±å¾—æåˆ°å¾ˆå¤šå¹´å‰çš„ç¨‹åºéƒ½æ˜¯ä½œä¸ºç”¨æˆ·çº§è¿›ç¨‹è¿›è¡Œçš„ï¼Œä¸ºäº†åˆ†æåªåœ¨å†…æ ¸ç©ºé—´çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®éƒ½å¾—ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„å†…å­˜ä¸­ï¼Œå› æ­¤ä¼šæœ‰å¤§é‡çš„å¼€é”€ã€‚</li>
</ol></li>
<li><ol start="3" type="1">
<li>éšç€ç°åœ¨çš„æ•°æ®å¢å¤šï¼Œä¸å¾—ä¸æ”¾å¼ƒåœ¨ç”¨æˆ·ç©ºé—´åˆ†æå†…æ ¸æ•°æ®ï¼Œå› è€ŒBPFåº”è¿è€Œç”Ÿâ€”â€”ä¸€ç§åœ¨å†…æ ¸ç©ºé—´æ‰§è¡Œé«˜æ•ˆå®‰å…¨çš„ç¨‹åºçš„æœºåˆ¶ã€‚è¿™é‡ŒBPFçš„åŸç†å°±ä¸æ·±ç©¶äº†ï¼Œå…·ä½“çœ‹æ€ä¹ˆä½¿ç”¨ã€‚</li>
</ol></li>
</ul>
<pre><code>å…ˆå®‰è£…bpftraceï¼š
    apt-get install bpftrace  #ubuntuç³»ç»Ÿ
    dnf install bpftrace   ##fedroaç³»ç»Ÿ
æˆ‘é€šè¿‡ubuntuçš„aptå®‰è£…çš„æ˜¯0.14å‘è¡Œç‰ˆï¼Œä½†bpftraceä¼šå‡ºç°&quot;æ®µé”™è¯¯&quot;ã€‚æˆ‘æºç å®‰è£…éƒ½æ²¡ç”¨ï¼Œå¤ªğŸ€è›‹äº†ï¼ï¼ï¼
ç½‘ä¸ŠæŸ¥é˜…åˆ°çš„è§£æå°±æ˜¯ï¼Œä½ å†å®‰è£…ä¸€éæ–°ç‰ˆæœ¬ï¼Œv-0.14ç‰ˆæœ¬å¤ªè€äº†ã€‚ä¸‹è½½APPImageå®‰è£…å§ã€‚</code></pre>
<p><a href="https://github.com/bpftrace/bpftrace/discussions/3026">bpf -0.14 æ®µé”™è¯¯å®˜æ–¹å›ç­”</a></p>
<pre><code>ç¼–å†™test.bt:
kprobe:ext2_read_folio
{
        @start[tid] = nsecs;
        printf(&quot;kprobe\n&quot;);
        print(kstack());
}

kretprobe:ext2_read_folio
{
        $us = (nsecs - @start[tid]) / 100;
        printf(&quot;kretprobe, duration %d\n&quot;, $us);
        delete(@start[tid]);
        print(kstack());
}
ç„¶åæ‰§è¡Œå‘½ä»¤
bpftrace test.bt &amp;
mkfs.ext2 -F image
mount image /mnt
echo something &gt; /mnt/file
echo 3 &gt; /proc/sys/vm/drop_caches
cat /mnt/file</code></pre>
<p>test.bt è„šæœ¬é€šè¿‡ä»¥ä¸‹æ–¹å¼è·Ÿè¸ª ext2_read_folio è„šæœ¬ä¸­åŒ…å«ä¸¤ä¸ªæ¢é’ˆï¼ˆkprobe å’Œ kretprobeï¼‰ï¼Œè®°å½•è¿›å…¥readå‡½æ•°å’Œå‡ºreadå‡½æ•°çš„æ—¶é—´æˆ³ï¼Œå¹¶è®¡ç®—ã€‚</p>
<h4 id="åœ¨ubuntu-22.04ä¸Šå®‰è£…bccçš„å®Œæ•´æŒ‡å—">åœ¨Ubuntu 22.04ä¸Šå®‰è£…BCCçš„å®Œæ•´æŒ‡å—</h4>
<h5 id="bcc-bpf-compiler-collection-æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºé«˜æ•ˆå†…æ ¸è¿½è¸ªå’Œæ“ä½œå·¥å…·çš„å·¥å…·åŒ…åŸºäºæ‰©å±•çš„ä¼¯å…‹åˆ©åŒ…è¿‡æ»¤å™¨ebpfæŠ€æœ¯æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨ubuntu-22.04ä¸Šå®‰è£…å’ŒéªŒè¯bccçš„æ­¥éª¤">BCC (BPF Compiler Collection) æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºé«˜æ•ˆå†…æ ¸è¿½è¸ªå’Œæ“ä½œå·¥å…·çš„å·¥å…·åŒ…ï¼ŒåŸºäºæ‰©å±•çš„ä¼¯å…‹åˆ©åŒ…è¿‡æ»¤å™¨(eBPF)æŠ€æœ¯ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨Ubuntu 22.04ä¸Šå®‰è£…å’ŒéªŒè¯BCCçš„æ­¥éª¤ã€‚</h5>
<h5 id="æ–¹æ³•ä¸€ä½¿ç”¨ppaæºå®‰è£…æ¨è">æ–¹æ³•ä¸€ï¼šä½¿ç”¨PPAæºå®‰è£…ï¼ˆæ¨èï¼‰</h5>
<p>è¿™æ˜¯æœ€ç®€å•å¿«æ·çš„å®‰è£…æ–¹æ³•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç”¨æˆ·ã€‚</p>
<h6 id="æ­¥éª¤1æ·»åŠ bcc-ppaæº">æ­¥éª¤1ï¼šæ·»åŠ BCC PPAæº</h6>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="fu">sudo</span> apt-add-repository ppa:hadret/bpfcc</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="fu">sudo</span> apt-get update</span></code></pre></div>
<h6 id="æ­¥éª¤2å®‰è£…bccåŒ…">æ­¥éª¤2ï¼šå®‰è£…BCCåŒ…</h6>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y bpfcc-tools python3-bpfcc</span></code></pre></div>
<h6 id="æ­¥éª¤3éªŒè¯å®‰è£…">æ­¥éª¤3ï¼šéªŒè¯å®‰è£…</h6>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="co"># åˆ—å‡ºå·²å®‰è£…çš„BCCå·¥å…·</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="fu">find</span> /usr -name <span class="st">&quot;*-bpfcc&quot;</span> -type f <span class="kw">|</span> <span class="fu">sort</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a><span class="co"># éªŒè¯Pythonæ¨¡å—</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a><span class="ex">python3</span> -c <span class="st">&quot;import bcc; print(bcc.__file__)&quot;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a><span class="co"># æµ‹è¯•è¿è¡ŒBCCç¨‹åºï¼ˆä¾‹å¦‚execsnoopï¼‰</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a><span class="fu">sudo</span> execsnoop-bpfcc -h</span></code></pre></div>
<h5 id="æ–¹æ³•äºŒä»æºä»£ç ç¼–è¯‘å®‰è£…">æ–¹æ³•äºŒï¼šä»æºä»£ç ç¼–è¯‘å®‰è£…</h5>
<p>å¦‚æœä½ éœ€è¦æœ€æ–°ç‰ˆæœ¬æˆ–è‡ªå®šä¹‰æ„å»ºï¼Œå¯ä»¥ä»æºä»£ç å®‰è£…ã€‚</p>
<h6 id="æ­¥éª¤1å®‰è£…ä¾èµ–é¡¹">æ­¥éª¤1ï¼šå®‰è£…ä¾èµ–é¡¹</h6>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="co"># å®‰è£…åŸºæœ¬ä¾èµ–</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="fu">sudo</span> apt-get update</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y bison build-essential cmake flex git libedit-dev <span class="kw">\</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>  <span class="ex">libllvm14</span> llvm-14-dev libclang-14-dev python3 zlib1g-dev libelf-dev <span class="kw">\</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a>  <span class="ex">libfl-dev</span> python3-pip</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a><span class="co"># å®‰è£…å…¶ä»–ä¾èµ–</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y arping clang-14 dh-python libdbus-1-dev libluajit-5.1-dev <span class="kw">\</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a>  <span class="ex">luajit</span> libpcap-dev libpython3-dev libzip-dev python3-netaddr python3-pyroute2</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a><span class="co"># å®‰è£…å†…æ ¸å¤´æ–‡ä»¶</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a><span class="fu">sudo</span> apt-get install -y linux-headers-<span class="va">$(</span><span class="fu">uname</span> -r<span class="va">)</span></span></code></pre></div>
<h6 id="æ­¥éª¤2å…‹éš†bccä»“åº“">æ­¥éª¤2ï¼šå…‹éš†BCCä»“åº“</h6>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="bu">cd</span> ~</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="fu">git</span> clone https://github.com/iovisor/bcc.git</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a><span class="co"># å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒï¼š</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a><span class="co"># git clone https://gitee.com/mirrors/bcc.git</span></span></code></pre></div>
<h6 id="æ­¥éª¤3ç¼–è¯‘å’Œå®‰è£…">æ­¥éª¤3ï¼šç¼–è¯‘å’Œå®‰è£…</h6>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="fu">mkdir</span> -p ~/bcc/build <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ~/bcc/build</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="fu">cmake</span> -DCMAKE_INSTALL_PREFIX=/usr -DPYTHON_CMD=python3 ..</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a><span class="fu">make</span> -j<span class="va">$(</span><span class="ex">nproc</span><span class="va">)</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a><span class="fu">sudo</span> make install</span></code></pre></div>
<h6 id="æ­¥éª¤4éªŒè¯å®‰è£…">æ­¥éª¤4ï¼šéªŒè¯å®‰è£…</h6>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="co"># éªŒè¯Pythonæ¨¡å—</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="ex">python3</span> -c <span class="st">&quot;import bcc; print(bcc.__file__)&quot;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a><span class="co"># æµ‹è¯•BCCå·¥å…·</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a><span class="fu">sudo</span> /usr/share/bcc/tools/execsnoop</span></code></pre></div>
<h5 id="åˆ›å»ºå¹¶è¿è¡Œè‡ªå·±çš„bccç¨‹åº">åˆ›å»ºå¹¶è¿è¡Œè‡ªå·±çš„BCCç¨‹åº</h5>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="co">#!/usr/bin/python3</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="co"># æ–‡ä»¶å: test_bcc.py</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="im">from</span> bcc <span class="im">import</span> BPF</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a><span class="co"># å®šä¹‰BPFç¨‹åº</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a>program <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a><span class="st">int hello(void *ctx) {</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a><span class="st">    bpf_trace_printk(&quot;Hello, BCC!</span><span class="ch">\\</span><span class="st">n&quot;);</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true"></a><span class="st">    return 0;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true"></a><span class="co"># åŠ è½½BPFç¨‹åº</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true"></a>b <span class="op">=</span> BPF(text<span class="op">=</span>program)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true"></a>b.attach_kprobe(event<span class="op">=</span>b.get_syscall_fnname(<span class="st">&quot;clone&quot;</span>), fn_name<span class="op">=</span><span class="st">&quot;hello&quot;</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true"></a><span class="co"># æ‰“å°å¤´éƒ¨</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;æ­£åœ¨è·Ÿè¸ªclone()ç³»ç»Ÿè°ƒç”¨...&quot;</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;æŒ‰Ctrl+Cé€€å‡º&quot;</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true"></a><span class="co"># è¯»å–å¹¶æ‰“å°traceè¾“å‡º</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true"></a><span class="cf">try</span>:</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true"></a>    b.trace_print()</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true"></a>    <span class="cf">pass</span></span></code></pre></div>
<p>è¿è¡Œæ­¤è„šæœ¬ï¼š</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="fu">chmod</span> +x test_bcc.py</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a><span class="fu">sudo</span> ./test_bcc.py</span></code></pre></div>
<h5 id="å¸¸ç”¨bccå·¥å…·">å¸¸ç”¨BCCå·¥å…·</h5>
<p>BCCå®‰è£…åæä¾›äº†è®¸å¤šå¼ºå¤§çš„å·¥å…·ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>execsnoop-bpfcc</code> - è·Ÿè¸ªæ–°è¿›ç¨‹çš„æ‰§è¡Œ</li>
<li><code>opensnoop-bpfcc</code> - è·Ÿè¸ªopen()ç³»ç»Ÿè°ƒç”¨</li>
<li><code>tcptracer-bpfcc</code> - è·Ÿè¸ªTCPè¿æ¥</li>
<li><code>tcpconnect-bpfcc</code> - è·Ÿè¸ªä¸»åŠ¨TCPè¿æ¥</li>
<li><code>tcpaccept-bpfcc</code> - è·Ÿè¸ªè¢«åŠ¨TCPè¿æ¥</li>
<li><code>biosnoop-bpfcc</code> - è·Ÿè¸ªå—I/Oå»¶è¿Ÿ</li>
<li><code>funccount-bpfcc</code> - ç»Ÿè®¡å‡½æ•°è°ƒç”¨æ¬¡æ•°</li>
<li><code>stackcount-bpfcc</code> - ç»Ÿè®¡å†…æ ¸å †æ ˆè½¨è¿¹</li>
</ul>
<p>ä½¿ç”¨è¿™äº›å·¥å…·æ—¶éœ€è¦åŠ ä¸Š<code>sudo</code>æƒé™ã€‚</p>
<h5 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h5>
<ul>
<li><a href="https://github.com/iovisor/bcc">BCCå®˜æ–¹GitHubä»“åº“</a></li>
<li><a href="https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md">BCCå‚è€ƒæŒ‡å—</a></li>
<li><a href="https://www.brendangregg.com/ebpf.html">Linux eBPFè¿½è¸ªå·¥å…·</a></li>
</ul>
<h3 id="åsmbæ–‡ä»¶ç³»ç»Ÿ">åã€SMBæ–‡ä»¶ç³»ç»Ÿ</h3>
<h4 id="serveræ­å»º">1.Serveræ­å»º</h4>
<h5 id="ç”¨æˆ·æ€">1.1 ç”¨æˆ·æ€</h5>
<pre><code># å¾…åŠç†</code></pre>
<h3 id="åä¸€linux-å†…æ ¸å®æˆ˜">åä¸€ã€Linux å†…æ ¸å®æˆ˜</h3>
<h4 id="æœ¬åœ°æŒ‚è½½-nfs-å…±äº«">æœ¬åœ°æŒ‚è½½ NFS å…±äº«</h4>
<pre><code># åˆ›å»ºæŒ‚è½½ç‚¹
sudo mkdir -p /mnt/nfs

# æŒ‚è½½æœ¬åœ°å…±äº« (ä½¿ç”¨NFSv4åè®®)
sudo mount -t nfs -o vers=4.1 localhost:/nfs_share /mnt/nfs_test

# éªŒè¯æŒ‚è½½
df -hT | grep nfs4
# åº”è¾“å‡ºç±»ä¼¼ï¼š
# localhost:/nfs_share nfs4   503G   41G  437G    9% /mnt/nfs_test

# å†™æ“ä½œ
# dd if=/dev/urandom of=/mnt/nfs_test/large_file.dat bs=1M count=10 status=progress</code></pre>
<h4 id="nfs_latencyæµ‹è¯•">1.nfs_latencyæµ‹è¯•</h4>
<p>ç”¨bpfè·å–rpcæ‰§è¡Œæ—¶é—´æˆ³ï¼Œè®¡ç®—å‡½æ•°æ‰§è¡Œæ—¶é—´è¿™ä¸ªä»£ç æ˜¯è®°å½•æ¯è°ƒç”¨ä¸€æ¬¡rpcï¼Œå°±è®°å½•è°ƒç”¨çš„rpcæ—¶é—´ã€‚ä»£ç å…·ä½“ç”¨åˆ°äº†hashmapå»å­˜å‚¨æ¯ä¸ªè¿›ç¨‹å·ã€å½“å‰æ—¶é—´æˆ³ã€‚ç”¨æ•°ç»„å»è®°å½•è¿›ç¨‹çš„pidå’Œå¯¹åº”çš„è€—æ—¶æ—¶é—´ã€‚</p>
<h5> åŸå§‹ä»£ç </h5>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>nfs.bpf.c</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="co">// SPDX-License-Identifier: GPL-2.0</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;vmlinux.h&quot;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;bpf/bpf_helpers.h&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;bpf/bpf_tracing.h&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true"></a><span class="dt">char</span> LICENSE[] SEC(<span class="st">&quot;license&quot;</span>) = <span class="st">&quot;GPL&quot;</span>;</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true"></a><span class="kw">struct</span> event {</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true"></a>    u32 pid;       <span class="co">//pidè¿›ç¨‹</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true"></a>    u64 delta_ns;   <span class="co">//è€—æ—¶æ—¶é—´</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true"></a>    <span class="dt">char</span> comm[<span class="dv">16</span>];   <span class="co">//è¿›ç¨‹å</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true"></a>};</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true"></a><span class="kw">struct</span> {</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true"></a>    __uint(type, BPF_MAP_TYPE_HASH); <span class="co">//æŒ‡å®šç±»å‹æ˜¯BPF_MAP_TYPE_HASH ----å“ˆå¸Œè¡¨</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true"></a>    __uint(max_entries, <span class="dv">4096</span>);          <span class="co">//æœ€å¤§keyæ•°é‡=4096</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true"></a>    __type(key, u64);       </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true"></a>    __type(value, u64);</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true"></a>} start SEC(<span class="st">&quot;.maps&quot;</span>);  <span class="co">//SECæ˜¯æŒ‡å®šå°†è¿™ä¸ªç»“æ„ä½“æ”¾åœ¨BPFçš„.mapsæ®µä¸­ï¼Œåœ¨BPFä¸­ï¼Œæ®µæ˜¯ä¸€ç§ç»„ç»‡ä»£ç å’Œæ•°æ®çš„æ–¹å¼</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true"></a><span class="kw">struct</span> {</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true"></a>    __uint(type, BPF_MAP_TYPE_PERF_EVENT_ARRAY);  <span class="co">//æ•°ç»„</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true"></a>} events SEC(<span class="st">&quot;.maps&quot;</span>);</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true"></a>SEC(<span class="st">&quot;kprobe/rpc_call_start&quot;</span>)   <span class="co">//è¡¨ç¤ºè¿™ä¸ª BPF ç¨‹åºä¼šè¢«åŠ è½½åˆ°å†…æ ¸ä¸­ï¼Œå¹¶åœ¨æ¯æ¬¡rpc_call_startå†…æ ¸å‡½æ•°è¢«è°ƒç”¨æ—¶è§¦å‘æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯rpc_startå¼€å§‹æ‰§è¡Œæ—¶è§¦å‘</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true"></a><span class="dt">int</span> BPF_KPROBE(handle_rpc_start)  <span class="co">//BPF_KPROBEæ˜¯ä¸€ä¸ªå®ç”¨äºå®šä¹‰ä¸€ä¸ª kprobe ç±»å‹çš„ BPF ç¨‹åº</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true"></a>{</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true"></a>    u64 tid = bpf_get_current_pid_tgid();           <span class="co">//è·å–å½“å‰PIDå’ŒTGID</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true"></a>    u64 ts = bpf_ktime_get_ns();                <span class="co">//è·å–å½“å‰çš„æ—¶é—´æˆ³</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true"></a>    bpf_map_update_elem(&amp;start, &amp;tid, &amp;ts, BPF_ANY); <span class="co">//å‘startå“ˆå¸Œè¡¨é‡Œé¢æ›´æ–°æ•°æ®ï¼ŒPF_ANY è¡¨ç¤ºå¦‚æœé”®å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å€¼ï¼›å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥æ–°é”®å€¼å¯¹</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true"></a>}</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true"></a></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true"></a>SEC(<span class="st">&quot;kretprobe/rpc_call_done&quot;</span>)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true"></a><span class="dt">int</span> BPF_KRETPROBE(handle_rpc_done)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true"></a>{</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true"></a>    u64 tid = bpf_get_current_pid_tgid();</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true"></a>    u64 *tsp = bpf_map_lookup_elem(&amp;start, &amp;tid);</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true"></a>    <span class="cf">if</span> (!tsp)</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true"></a>        <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true"></a>    u64 delta = bpf_ktime_get_ns() - *tsp;   <span class="co">//å½“å‰æ—¶é—´æˆ³ä¸hashmapä¸­çš„æ—¶é—´æˆ³è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°æ‰§è¡Œæ—¶é—´ã€‚</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true"></a>    bpf_map_delete_elem(&amp;start, &amp;tid);</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true"></a></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true"></a>    <span class="kw">struct</span> event e = {};</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true"></a>    e.pid = tid &gt;&gt; <span class="dv">32</span>;</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true"></a>    e.delta_ns = delta;             </span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true"></a>    bpf_get_current_comm(&amp;e.comm, <span class="kw">sizeof</span>(e.comm));  <span class="co">//è·å–æ•°æ®å­˜å‚¨åˆ°eventç»“æ„ä½“é‡Œé¢</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true"></a>    bpf_perf_event_output(ctx, &amp;events, BPF_F_CURRENT_CPU, &amp;e, <span class="kw">sizeof</span>(e)); <span class="co">//</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true"></a>}</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true"></a>nfs.c</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;bpf/libbpf.h&gt;</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;nfs.skel.h&quot;</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true"></a></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">volatile</span> <span class="dt">bool</span> exiting = false;</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true"></a></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true"></a><span class="co">//ç”¨æˆ·æ€</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true"></a><span class="dt">void</span> handle_event(<span class="dt">void</span> *ctx, <span class="dt">int</span> cpu, <span class="dt">void</span> *data, __u32 size) <span class="co">//BPF ç¨‹åºè¾“å‡ºæ€§èƒ½äº‹ä»¶æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</span></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true"></a>{</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true"></a>    <span class="kw">struct</span> event *e = data;</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true"></a>    printf(<span class="st">&quot;PID %d (%s): %.2f ms</span><span class="sc">\n</span><span class="st">&quot;</span>, e-&gt;pid, e-&gt;comm, e-&gt;delta_ns / <span class="fl">1e6</span>);</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true"></a>}</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true"></a></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true"></a><span class="dt">void</span> handle_lost(<span class="dt">void</span> *ctx, <span class="dt">int</span> cpu, __u64 lost) <span class="co">//å½“æœ‰äº‹ä»¶æ•°æ®ä¸¢å¤±æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨</span></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true"></a>{</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true"></a>    fprintf(stderr, <span class="st">&quot;Lost %llu events on CPU %d</span><span class="sc">\n</span><span class="st">&quot;</span>, lost, cpu);</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true"></a>}</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true"></a></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true"></a><span class="dt">void</span> sig_handler(<span class="dt">int</span> sig)</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true"></a>{</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true"></a>    exiting = true;</span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true"></a>}</span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true"></a></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true"></a><span class="dt">int</span> main()</span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true"></a>{</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true"></a>    <span class="kw">struct</span> nfs_bpf *skel;</span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true"></a>    <span class="dt">int</span> err;</span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true"></a></span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true"></a>    signal(SIGINT, sig_handler);</span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true"></a>    signal(SIGTERM, sig_handler); <span class="co">//æ³¨å†Œä¿¡å·å¤„ç†ç¨‹åºï¼Œä»¥ä¾¿åœ¨æ”¶åˆ° SIGINT æˆ– SIGTERM æ—¶è°ƒç”¨ sig_handlerï¼Œ</span></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true"></a></span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true"></a>    skel = nfs_bpf__open();</span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true"></a>    <span class="cf">if</span> (!skel) {</span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true"></a>        fprintf(stderr, <span class="st">&quot;Failed to open skeleton</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true"></a>    }</span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true"></a></span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true"></a>    err = nfs_bpf__load(skel);</span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true"></a>    <span class="cf">if</span> (err) {</span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true"></a>        fprintf(stderr, <span class="st">&quot;Failed to load skeleton</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true"></a>    }</span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true"></a></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true"></a>    err = nfs_bpf__attach(skel);    <span class="co">//å°† BPF ç¨‹åºé™„åŠ åˆ°å†…æ ¸ä¸­çš„ kprobe å’Œ kretprobe ç‚¹</span></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true"></a>    <span class="cf">if</span> (err) {</span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true"></a>        fprintf(stderr, <span class="st">&quot;Failed to attach</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true"></a>    }</span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true"></a></span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true"></a>    printf(<span class="st">&quot;Tracing NFS client RPC latency... Ctrl+C to exit</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true"></a></span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true"></a>    <span class="kw">struct</span> perf_buffer *pb = NULL;</span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true"></a>    pb = perf_buffer__new(bpf_map__fd(skel-&gt;maps.events), <span class="dv">8</span>,</span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true"></a>                          handle_event, handle_lost, NULL, NULL);  <span class="co">//åˆ›å»ºç¼“å†²åŒºæ¥æ¥æ”¶ç¨‹åºè¾“å‡ºçš„äº‹ä»¶æ•°æ®</span></span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true"></a>    <span class="cf">if</span> (!pb) {</span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true"></a>        fprintf(stderr, <span class="st">&quot;Failed to open perf buffer</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true"></a>    }</span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true"></a></span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true"></a>    <span class="cf">while</span> (!exiting)</span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true"></a>        perf_buffer__poll(pb, <span class="dv">100</span>);  <span class="co">//è½®è¯¢ç¼“å†²åŒºï¼Œç­‰å¾…äº‹ä»¶æ•°æ®çš„åˆ°æ¥ï¼Œ pollè½®è¯¢å¯ä»¥å¿«é€Ÿå“åº”ã€‚</span></span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true"></a></span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true"></a>    perf_buffer__free(pb);</span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true"></a>    nfs_bpf__destroy(skel);</span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true"></a>}</span></code></pre></div>
<h5 id="ä¿®æ”¹éƒ¨åˆ†">ä¿®æ”¹éƒ¨åˆ†</h5>
<h6 id="error-å½“å‰ç›®å½•ä¸‹æ²¡æœ‰-vmlinux.h-æ–‡ä»¶è¿™ä¸ªæ–‡ä»¶åœ¨-nfs.bpf.c-ä¸­è¢«å¼•ç”¨">ï¼ˆ1ï¼‰error: å½“å‰ç›®å½•ä¸‹æ²¡æœ‰ vmlinux.h æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨ nfs.bpf.c ä¸­è¢«å¼•ç”¨</h6>
<p><code>sudo bpftool btf dump file /sys/kernel/btf/vmlinux format c &gt; vmlinux.h</code> è¿™æ¡å‘½ä»¤å®ƒä»è¿è¡Œä¸­çš„ Linux å†…æ ¸ä¸­æå–ç±»å‹ä¿¡æ¯ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º C è¯­è¨€å¤´æ–‡ä»¶æ ¼å¼</p>
<h6 id="error-struct_eventæ²¡æœ‰åœ¨nfs.cå®šä¹‰">ï¼ˆ2ï¼‰error: struct_eventæ²¡æœ‰åœ¨nfs.cå®šä¹‰</h6>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a><span class="kw">struct</span> event {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>    __u32 pid;       <span class="co">// è¿›ç¨‹ ID</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>    __u64 delta_ns;  <span class="co">// è€—æ—¶æ—¶é—´</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a>    <span class="dt">char</span> comm[<span class="dv">16</span>]; <span class="co">// è¿›ç¨‹å</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a>};</span></code></pre></div>
<p>åŠ å…¥åˆ°nfs.cä¸­ã€‚</p>
<h6 id="perf_buffer__new-å‡½æ•°è°ƒç”¨çš„å‚æ•°æ•°é‡ä¸æ­£ç¡®æˆ‘ä»¬ä½¿ç”¨çš„å‚æ•°æ˜¯-6-ä¸ªä½†å‡½æ•°å®šä¹‰åªæ¥å—-3-ä¸ªå‚æ•°">ï¼ˆ3ï¼‰perf_buffer__new() å‡½æ•°è°ƒç”¨çš„å‚æ•°æ•°é‡ä¸æ­£ç¡®ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å‚æ•°æ˜¯ 6 ä¸ªï¼Œä½†å‡½æ•°å®šä¹‰åªæ¥å— 3 ä¸ªå‚æ•°</h6>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‡½æ•°æ­£ç¡®çš„å‚æ•°ï¼š</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a>perf_buffer__new(<span class="dt">int</span> map_fd, <span class="dt">size_t</span> page_cnt,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a>                 <span class="dt">const</span> <span class="kw">struct</span> perf_buffer_opts *opts);</span></code></pre></div>
<p>æ¥çœ‹ä¸€ä¸‹perf_buffer_optsç»“æ„ä½“</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a><span class="kw">struct</span> perf_buffer_opts {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a>        <span class="co">/* if specified, sample_cb is called for each sample */</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>        perf_buffer_sample_fn sample_cb;</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a>        <span class="co">/* if specified, lost_cb is called for each batch of lost samples */</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a>        perf_buffer_lost_fn lost_cb;</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a>        <span class="co">/* ctx is provided to sample_cb and lost_cb */</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a>        <span class="dt">void</span> *ctx;</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true"></a>};</span></code></pre></div>
<p>å…¶å®å°±å¯ä»¥çœ‹å‡ºï¼Œè°ƒç”¨çš„APIå‡½æ•°å·²ç»æ›´æ–°äº†ï¼Œåªæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ–°ç‰ˆæœ¬çš„APIï¼Œæ˜¯æŠŠäº‹ä»¶å›è°ƒã€ä¸¢å¤±äº‹ä»¶å›è°ƒã€ç”¨æˆ·ä¸Šä¸‹æ–‡æ”¾åˆ°ç»“æ„ä½“é‡Œé¢ï¼Œç„¶åè¿›è¡Œç»“æ„ä½“æŒ‡é’ˆä¼ å‚ã€‚</p>
<h6 id="å†…æ ¸ä¸­æœ‰-rpc_call_start-å‡½æ•°ä½†æ²¡æœ‰-rpc_call_done-å‡½æ•°å¯¼è‡´ç¨‹åº.nfsæ— æ³•åŠ è½½">ï¼ˆ4ï¼‰å†…æ ¸ä¸­æœ‰ rpc_call_start å‡½æ•°ï¼Œä½†æ²¡æœ‰ rpc_call_done å‡½æ•°ã€‚å¯¼è‡´ç¨‹åº.nfsæ— æ³•åŠ è½½</h6>
<p>åŒæ ·å¯èƒ½æ˜¯å†…æ ¸ç‰ˆæœ¬ä¸åŒï¼Œå°† rpc_call_done æ”¹ä¸º rpc_task_call_done</p>
<h6 id="map-events-åˆ›å»ºå¤±è´¥çš„é—®é¢˜">ï¼ˆ5ï¼‰map â€˜eventsâ€™ åˆ›å»ºå¤±è´¥çš„é—®é¢˜</h6>
<p>map â€˜eventsâ€™: failed to create: Invalid argument ä»è¿™å¥æç¤ºå¯ä»¥çœ‹å‡º eventsçš„ç»“æ„ä½“å®šä¹‰ä¸å¯¹ï¼Œmapå®šä¹‰ï¼Œæ·»åŠ æ›´å¤šç‰¹å®šå‚æ•°ä»¥æ»¡è¶³å†…æ ¸è¦æ±‚ï¼š</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a><span class="kw">struct</span> {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a>    __uint(type, BPF_MAP_TYPE_PERF_EVENT_ARRAY);  <span class="co">//æ•°ç»„</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a>    __uint(key_size, <span class="kw">sizeof</span>(<span class="dt">int</span>));</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a>    __uint(value_size, <span class="kw">sizeof</span>(<span class="dt">int</span>));</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a>    __uint(max_entries, <span class="dv">128</span>);</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a>} events SEC(<span class="st">&quot;.maps&quot;</span>);</span></code></pre></div>
<h6 id="æ— æ³•æ‰¾åˆ°-rpc_task_call_done-å‡½æ•°è¿›è¡Œ-kretprobe">ï¼ˆ6ï¼‰æ— æ³•æ‰¾åˆ° rpc_task_call_done å‡½æ•°è¿›è¡Œ kretprobe</h6>
<p><code>sudo ls -la /sys/kernel/debug/tracing/events/sunrpc/</code> è¾“å…¥æŒ‡ä»¤åå‘ç°äº† /sys/kernel/debug/tracing/events/sunrpc/rpc_task_call_doneï¼Œè¿™è¡¨æ˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ tracepoint è€Œä¸æ˜¯ kprobe,å› æ­¤ä¿®æ”¹ã€‚</p>
<h6 id="ç”±æ­¤å¯ä»¥çœ‹å‡ºå¤§éƒ¨åˆ†éƒ½æ˜¯ç‰ˆæœ¬é—®é¢˜">ï¼ˆ7ï¼‰ç”±æ­¤å¯ä»¥çœ‹å‡ºå¤§éƒ¨åˆ†éƒ½æ˜¯ç‰ˆæœ¬é—®é¢˜</h6>
<ol type="1">
<li>æˆ‘çš„libbpfç‰ˆæœ¬æ˜¯0.5.0ï¼Œ ubuntuçš„å†…æ ¸ç‰ˆæœ¬æ˜¯6.8.0-59ã€‚</li>
<li>perf_buffer API å˜åŒ–ï¼Œä½¿ç”¨ç»“æ„ä½“ä¼ å‚ã€‚</li>
<li>kprobe åˆ° tracepoint çš„è¿ç§»ã€æ—§ç‰ˆæœ¬: ä½¿ç”¨ kprobe/kretprobe è·Ÿè¸ªç‰¹å®šå‡½æ•°ï¼Œæ–°ç‰ˆæœ¬: ä½¿ç”¨ tracepoint è·Ÿè¸ªæ ‡å‡†åŒ–çš„äº‹ä»¶ç‚¹</li>
<li>Map å®šä¹‰çš„å®Œæ•´æ€§è¦æ±‚,æ—§ç‰ˆæœ¬: æœ€å°åŒ–å®šä¹‰å¯èƒ½è¶³å¤Ÿ,æ–°ç‰ˆæœ¬: éœ€è¦æ›´å®Œæ•´çš„å®šä¹‰ï¼ŒåŒ…æ‹¬ key_size, value_size, max_entries ##### æœ€åé€šè¿‡nfsæŒ‚è½½æµ‹è¯• ###### æœ¬åœ°æŒ‚è½½ NFS å…±äº«</li>
</ol>
<pre><code># åˆ›å»ºæŒ‚è½½ç‚¹
sudo mkdir -p /mnt/nfs                
# æŒ‚è½½æœ¬åœ°å…±äº« (ä½¿ç”¨NFSv4åè®®)
sudo mount -t nfs -o vers=4.1 localhost:/nfs_share /mnt/nfs                
# éªŒè¯æŒ‚è½½
df -hT | grep nfs4
# åº”è¾“å‡ºç±»ä¼¼ï¼š
# localhost:/nfs_share nfs4   503G   41G  437G    9% /mnt/nfs                
# å†™æ“ä½œ
dd if=/dev/urandom of=/mnt/nfs_share bs=1M count=10 status=progress</code></pre>
<h6 id="è¿è¡Œè„šæœ¬æ–‡ä»¶">è¿è¡Œè„šæœ¬æ–‡ä»¶</h6>
<pre><code>sudo make
sudo ./nfs
#å…ˆè¿è¡Œ./nfs è‡ªå»è¿›è¡Œå†™æ“ä½œ
#è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š
Tracing NFS client RPC latency... Ctrl+C to exit
PID 14807 (ls): 49.01 ms</code></pre>
<h4 id="é’ˆå¯¹nfsè¯»å†™æ…¢ç¼–å†™btè„šæœ¬">2.é’ˆå¯¹nfsè¯»å†™æ…¢ï¼Œç¼–å†™btè„šæœ¬</h4>
<h5 id="nfs-å†™æ“ä½œæ ¸å¿ƒå‡½æ•°ç®€åŒ–ç‰ˆ">NFS å†™æ“ä½œæ ¸å¿ƒå‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰</h5>
<h5 id="å®¢æˆ·ç«¯æµç¨‹">å®¢æˆ·ç«¯æµç¨‹</h5>
<ol type="1">
<li>ç”¨æˆ·å‘èµ·å†™æ“ä½œ<br />
<code>write()</code> â†’ <code>vfs_write()</code> â†’ <code>nfs_file_write()</code></li>
<li>æ•°æ®ç¼“å­˜ä¸æäº¤<br />
<code>nfs_write_begin()</code> â†’ é¡µç¼“å­˜æ“ä½œ â†’ <code>nfs_write_end()</code></li>
<li>RPC ç½‘ç»œé€šä¿¡ <code>nfs_initiate_write()</code> â†’ <code>rpc_call_sync()</code> â†’ NFSv3 <code>WRITE</code> / NFSv4 <code>COMPOUND</code></li>
</ol>
<h5 id="æœåŠ¡ç«¯æµç¨‹">æœåŠ¡ç«¯æµç¨‹</h5>
<ol type="1">
<li>æ¥æ”¶è¯·æ±‚ <code>nfsd_dispatch()</code> â†’ <code>nfsd3_proc_write()</code> (NFSv3) / <code>nfsd4_proc_write()</code> (NFSv4)</li>
<li>å†™å…¥å­˜å‚¨ <code>nfsd_vfs_write()</code> â†’ <code>vfs_writev()</code></li>
</ol>
<h5 id="å…³é”®å‡½æ•°">å…³é”®å‡½æ•°</h5>
<ul>
<li>å®¢æˆ·ç«¯ï¼š<code>nfs_file_write</code>, <code>nfs_writepages</code>, <code>rpc_call_sync</code></li>
<li>æœåŠ¡ç«¯ï¼š<code>nfsd_proc_write</code>, <code>vfs_writev</code></li>
</ul>
<h3 id="é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°tips">é‡åˆ°çš„å¸¸è§é—®é¢˜çš„å°Tips</h3>
<h4 id="è™šæ‹Ÿæœºå¡åœ¨äº†boot-form-hard-diské˜¶æ®µ">1. è™šæ‹Ÿæœºå¡åœ¨äº†Boot form Hard Diské˜¶æ®µ</h4>
<p>è¿™ç§æƒ…å†µåªèƒ½é‡è£…è™šæ‹Ÿæœºç³»ç»Ÿ<br />
æ³¨ï¼šåšå®éªŒåƒä¸‡ä¸è¦åœ¨Vitrual managerçš„è™šæ‹Ÿæœºä¸Šè·‘ï¼Œæœ€å¥½åœ¨qemuä¸Šè·‘ã€‚</p>
<h4 id="è°ƒè¯•è¡¥ä¸">2. è°ƒè¯•è¡¥ä¸</h4>
<ul>
<li>åº”ç”¨è¡¥ä¸ï¼š ç¡®ä¿ä½ çš„å·¥ä½œç›®å½•æ˜¯ä½ çš„Linuxå†…æ ¸æºä»£ç æ ¹ç›®å½•ï¼Œpatchå‘½ä»¤åº”ç”¨è¡¥ä¸<br />
<code>patch -p1 &lt; /home/linux/blog/course/kernel/src/0001-debug-vfs.patch</code></li>
<li>ç„¶åé…ç½®å†…æ ¸<code>make menuconfig</code>ã€ç¼–è¯‘å†…æ ¸<code>make bzImage -j8</code></li>
</ul>
<h4 id="git-cloneæ—¶å€™failed-to-connect-to-github.com-port-443-after-0-ms-è¿æ¥è¢«æ‹’ç»">3. git cloneæ—¶å€™ï¼šFailed to connect to github.com port 443 after 0 ms: è¿æ¥è¢«æ‹’ç»</h4>
<ul>
<li>å¦‚æœåœ¨å­¦æ ¡å’Œå…¬å¸æ— æ³•åœ¨ç½‘ç«™ä¸Šè®¿é—®ï¼Œå¯ä»¥ç”³è¯·ä¸€ä¸ªæœåŠ¡å™¨ä»£ç†ã€‚</li>
<li>æ£€æŸ¥é˜²ç«å¢™é…ç½®ã€‚<code>sudo systemctl disable firewalld</code></li>
</ul>
<h4 id="git-cloneæ—¶å€™failed-to-connect-to-github.com-port-443-after-0-ms-è¿æ¥è¢«æ‹’ç»-1">3.git cloneæ—¶å€™ï¼šFailed to connect to github.com port 443 after 0 ms: è¿æ¥è¢«æ‹’ç»</h4>
<ul>
<li><ol type="1">
<li>å¦‚æœåœ¨å­¦æ ¡å’Œå…¬å¸æ— æ³•åœ¨ç½‘ç«™ä¸Šè®¿é—®ï¼Œå¯ä»¥ç”³è¯·ä¸€ä¸ªæœåŠ¡å™¨ä»£ç†ã€‚</li>
</ol></li>
<li><ol start="2" type="1">
<li>æ£€æŸ¥é˜²ç«å¢™é…ç½®ã€‚<code>sudo systemctl disable firewalld</code></li>
</ol></li>
</ul>
<h4 id="ç¼–è¯‘çš„.koæ–‡ä»¶å¦‚ä½•æ˜ å°„åˆ°å†…æ ¸æ–‡ä»¶é‡Œé¢">4.ç¼–è¯‘çš„.koæ–‡ä»¶ï¼Œå¦‚ä½•æ˜ å°„åˆ°å†…æ ¸æ–‡ä»¶é‡Œé¢ï¼Ÿ</h4>
<ul>
<li><ol type="1">
<li>åŠ è½½å†…æ ¸æ¨¡å—:<code>sudo insmod your_module.ko</code> æˆ–è€…<code>sudo modprobe your_module</code></li>
</ol></li>
<li><ol start="2" type="1">
<li>éªŒè¯æ˜¯å¦åŠ è½½æˆåŠŸï¼š<code>lsmod | grep your_module</code></li>
</ol></li>
<li><ol start="3" type="1">
<li>å¸è½½æ¨¡å—ï¼š<code>sudo rmmod your_module</code></li>
</ol></li>
</ul>
<h2 id="å¾…åŠç†">å¾…åŠç†</h2>
</body>
</html>
